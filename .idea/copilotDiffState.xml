<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/dashboard/questions-manage/page.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/dashboard/questions-manage/page.tsx" />
              <option name="originalContent" value="&quot;use client&quot;&#10;&#10;import React, { useState, useEffect } from &quot;react&quot;&#10;import { Card, CardContent, CardHeader, CardTitle, CardDescription } from &quot;@/components/ui/card&quot;&#10;import { Button } from &quot;@/components/ui/button&quot;&#10;import { Checkbox } from &quot;@/components/ui/checkbox&quot;&#10;import { Input } from &quot;@/components/ui/input&quot;&#10;import { Textarea } from &quot;@/components/ui/textarea&quot;&#10;import { Badge } from &quot;@/components/ui/badge&quot;&#10;import { useToast } from &quot;@/hooks/use-toast&quot;&#10;import { Edit, Trash2, MoreHorizontal } from &quot;lucide-react&quot;&#10;import {&#10;  DropdownMenu,&#10;  DropdownMenuTrigger,&#10;  DropdownMenuContent,&#10;  DropdownMenuItem,&#10;  DropdownMenuLabel,&#10;  DropdownMenuSeparator,&#10;} from &quot;@/components/ui/dropdown-menu&quot;&#10;&#10;interface Question {&#10;  id: string&#10;  name: string&#10;  intent: string&#10;  filled_prompt: string&#10;  question_type: string&#10;}&#10;&#10;const MOCK_DB_QUESTIONS: Question[] = [&#10;  {&#10;    id: &quot;a3f1d6b2-1c2b-4d3a-8f1a-111111111111&quot;,&#10;    name: &quot;Bạn thường dùng sản phẩm bao lâu 1 lần?&quot;,&#10;    intent: &quot;frequency&quot;,&#10;    filled_prompt: &quot;Trong tháng qua, bạn đã sử dụng sản phẩm X bao nhiêu lần?&quot;,&#10;    question_type: &quot;scale&quot;,&#10;  },&#10;  {&#10;    id: &quot;b4f2d7c3-2d3c-5e4b-9f2b-222222222222&quot;,&#10;    name: &quot;Bạn có hài lòng với dịch vụ?&quot;,&#10;    intent: &quot;yesno&quot;,&#10;    filled_prompt: &quot;Bạn có hài lòng với dịch vụ của chúng tôi không?&quot;,&#10;    question_type: &quot;binary&quot;,&#10;  },&#10;  {&#10;    id: &quot;c5f3e8d4-3e4d-6f5c-af3c-333333333333&quot;,&#10;    name: &quot;Đánh giá trải nghiệm tổng thể&quot;,&#10;    intent: &quot;rating&quot;,&#10;    filled_prompt: &quot;Xin vui lòng đánh giá trải nghiệm tổng thể của bạn với sản phẩm (1-5)&quot;,&#10;    question_type: &quot;rating&quot;,&#10;  },&#10;]&#10;&#10;export default function ManageQuestionsPage() {&#10;  // DB questions are editable: start from mock DB. Expert list starts empty.&#10;  const [dbQuestions, setDbQuestions] = useState&lt;Question[]&gt;(MOCK_DB_QUESTIONS)&#10;  const [expertSelected, setExpertSelected] = useState&lt;Record&lt;string, boolean&gt;&gt;({})&#10;  const [name, setName] = useState(&quot;&quot;)&#10;  const [description, setDescription] = useState(&quot;&quot;)&#10;  // UI polish: search and filter for enterprise UX&#10;  const [searchQuery, setSearchQuery] = useState(&quot;&quot;)&#10;  const [intentFilter, setIntentFilter] = useState(&quot;&quot;)&#10;  const { toast } = useToast()&#10;&#10;  // drag-and-drop ordering state for Expert Questions&#10;  const [draggedId, setDraggedId] = useState&lt;string | null&gt;(null)&#10;&#10;  const onDragStart = (e: React.DragEvent&lt;HTMLDivElement&gt;, id: string) =&gt; {&#10;    setDraggedId(id)&#10;    e.dataTransfer.effectAllowed = &quot;move&quot;&#10;    try { e.dataTransfer.setData(&quot;text/plain&quot;, id) } catch (err) { /* some browsers require try/catch */ }&#10;  }&#10;&#10;  const onDragOver = (e: React.DragEvent&lt;HTMLDivElement&gt;) =&gt; {&#10;    e.preventDefault()&#10;    e.dataTransfer.dropEffect = &quot;move&quot;&#10;  }&#10;&#10;  const onDrop = (e: React.DragEvent&lt;HTMLDivElement&gt;, targetId: string) =&gt; {&#10;    e.preventDefault()&#10;    const sourceId = draggedId || e.dataTransfer.getData(&quot;text/plain&quot;)&#10;    if (!sourceId || sourceId === targetId) {&#10;      setDraggedId(null)&#10;      return&#10;    }&#10;&#10;    setExpertQuestions(prev =&gt; {&#10;      const copy = [...prev]&#10;      const fromIndex = copy.findIndex(x =&gt; x.id === sourceId)&#10;      const toIndex = copy.findIndex(x =&gt; x.id === targetId)&#10;      if (fromIndex === -1 || toIndex === -1) return prev&#10;      const [moved] = copy.splice(fromIndex, 1)&#10;      copy.splice(toIndex, 0, moved)&#10;      return copy&#10;    })&#10;&#10;    setDraggedId(null)&#10;  }&#10;&#10;  // New state: questions-manage expert questions list so we can edit/delete/reorder&#10;  const [expertQuestions, setExpertQuestions] = useState&lt;Question[]&gt;([])&#10;  const [editingId, setEditingId] = useState&lt;string | null&gt;(null)&#10;  const [editingData, setEditingData] = useState&lt;Partial&lt;Question&gt;&gt;({})&#10;&#10;  // New state: saved question sets created from selections&#10;  const [questionSets, setQuestionSets] = useState&lt;{&#10;    id: string&#10;    name: string&#10;    description: string&#10;    questionIds: string[]&#10;  }[]&gt;([])&#10;&#10;  // Load saved question sets from localStorage on mount&#10;  useEffect(() =&gt; {&#10;    try {&#10;      const raw = localStorage.getItem(&quot;questionSets&quot;)&#10;      if (raw) {&#10;        const parsed = JSON.parse(raw)&#10;        if (Array.isArray(parsed)) setQuestionSets(parsed)&#10;      }&#10;    } catch (e) {&#10;      console.warn(&quot;Failed to load saved question sets from localStorage&quot;, e)&#10;    }&#10;  }, [])&#10;&#10;  // Persist questionSets to localStorage whenever it changes&#10;  useEffect(() =&gt; {&#10;    try {&#10;      localStorage.setItem(&quot;questionSets&quot;, JSON.stringify(questionSets))&#10;    } catch (e) {&#10;      console.warn(&quot;Failed to save question sets to localStorage&quot;, e)&#10;    }&#10;  }, [questionSets])&#10;&#10;  const toggleExpert = (id: string, value: boolean) =&gt; {&#10;    setExpertSelected(prev =&gt; ({ ...prev, [id]: value }))&#10;  }&#10;&#10;  // Move a DB question into Expert questions for editing/rating&#10;  const moveDbToExpert = (id: string) =&gt; {&#10;    const q = dbQuestions.find(d =&gt; d.id === id)&#10;    if (!q) return&#10;    setExpertQuestions(prev =&gt; [q, ...prev])&#10;    setDbQuestions(prev =&gt; prev.filter(d =&gt; d.id !== id))&#10;    // remove any lingering selection state&#10;    setExpertSelected(prev =&gt; ({ ...prev }))&#10;    toast({ title: &quot;Moved&quot;, description: `Question moved to Expert list` })&#10;  }&#10;&#10;  const createQuestionSet = () =&gt; {&#10;    // After DB questions are moved to Expert list, only Expert-side selections apply&#10;    const selectedExpertIds = Object.entries(expertSelected).filter(([_, v]) =&gt; v).map(([k]) =&gt; k)&#10;    const questionIds = [...selectedExpertIds]&#10;&#10;    if (name.trim() === &quot;&quot;) {&#10;      toast({ title: &quot;Error&quot;, description: &quot;Please enter a name for the question set&quot;, variant: &quot;destructive&quot; })&#10;      return&#10;    }&#10;&#10;    if (questionIds.length === 0) {&#10;      toast({ title: &quot;Error&quot;, description: &quot;Please select at least one question&quot;, variant: &quot;destructive&quot; })&#10;      return&#10;    }&#10;&#10;    const newSet = {&#10;      id: `${Date.now()}`,&#10;      name: name.trim(),&#10;      description: description.trim(),&#10;      questionIds,&#10;    }&#10;&#10;    // Save the set locally (replace with API call if needed)&#10;    setQuestionSets(prev =&gt; [newSet, ...prev])&#10;&#10;    toast({ title: &quot;Success&quot;, description: `Question set &quot;${newSet.name}&quot; created (${questionIds.length} questions)` })&#10;&#10;    // Reset form and only unselect the questions that were used in the created set&#10;    setName(&quot;&quot;)&#10;    setDescription(&quot;&quot;)&#10;&#10;    setExpertSelected(prev =&gt; {&#10;      const copy = { ...prev }&#10;      selectedExpertIds.forEach(id =&gt; {&#10;        if (id in copy) delete copy[id]&#10;      })&#10;      return copy&#10;    })&#10;  }&#10;&#10;  // delete saved question set&#10;  const deleteQuestionSet = (id: string) =&gt; {&#10;    if (!window.confirm(&quot;Delete this question set?&quot;)) return&#10;    setQuestionSets(prev =&gt; prev.filter(s =&gt; s.id !== id))&#10;    toast({ title: &quot;Deleted&quot;, description: &quot;Question set removed&quot; })&#10;  }&#10;&#10;  // Expert question actions&#10;  const [pendingMoveId, setPendingMoveId] = useState&lt;string | null&gt;(null)&#10;&#10;  // perform the actual move from Expert back to DB&#10;  const deleteExpertQuestion = (id: string) =&gt; {&#10;    // find question in expert list&#10;    const q = expertQuestions.find(q =&gt; q.id === id)&#10;    if (q) {&#10;      // add back to DB questions at the top&#10;      setDbQuestions(prev =&gt; [q, ...prev])&#10;    }&#10;&#10;    // remove from expert list&#10;    setExpertQuestions(prev =&gt; prev.filter(q =&gt; q.id !== id))&#10;&#10;    // remove any expert selection state&#10;    setExpertSelected(prev =&gt; {&#10;      const copy = { ...prev }&#10;      delete copy[id]&#10;      return copy&#10;    })&#10;&#10;    toast({ title: &quot;Moved&quot;, description: &quot;Question moved back to Database Questions&quot; })&#10;  }&#10;&#10;  const promptMoveBack = (id: string) =&gt; {&#10;    setPendingMoveId(id)&#10;  }&#10;&#10;  const startEdit = (q: Question) =&gt; {&#10;    setEditingId(q.id)&#10;    setEditingData({ ...q })&#10;  }&#10;&#10;  const cancelEdit = () =&gt; {&#10;    setEditingId(null)&#10;    setEditingData({})&#10;  }&#10;&#10;  const saveEdit = () =&gt; {&#10;    if (!editingId) return&#10;    setExpertQuestions(prev =&gt; prev.map(q =&gt; (q.id === editingId ? { ...(q as Question), ...(editingData as Question) } : q)))&#10;    setEditingId(null)&#10;    setEditingData({})&#10;    toast({ title: &quot;Saved&quot;, description: &quot;Expert question has been updated&quot; })&#10;  }&#10;&#10;  // Compute selected question objects for preview&#10;  const selectedExpertQuestions = expertQuestions.filter(q =&gt; expertSelected[q.id])&#10;  const selectedQuestions = [...selectedExpertQuestions]&#10;&#10;  // helper to get question name by id&#10;  const getQuestionById = (id: string) =&gt; {&#10;    return dbQuestions.concat(expertQuestions).find(q =&gt; q.id === id)&#10;  }&#10;&#10;  // helper: map intent to badge color classes&#10;  const intentColor = (intent?: string) =&gt; {&#10;    switch (intent) {&#10;      case &quot;frequency&quot;:&#10;        return &quot;bg-blue-100 text-blue-800&quot;&#10;      case &quot;yesno&quot;:&#10;        return &quot;bg-green-100 text-green-800&quot;&#10;      case &quot;rating&quot;:&#10;        return &quot;bg-yellow-100 text-yellow-800&quot;&#10;      case &quot;choice&quot;:&#10;        return &quot;bg-indigo-100 text-indigo-800&quot;&#10;      case &quot;binary&quot;:&#10;        return &quot;bg-rose-100 text-rose-800&quot;&#10;      default:&#10;        return &quot;bg-gray-200 text-gray-800&quot;&#10;    }&#10;  }&#10;&#10;  // compute intents for filter select&#10;  const allIntents = Array.from(new Set(dbQuestions.concat(expertQuestions).map(q =&gt; q.intent))).filter(Boolean)&#10;&#10;  // filtered lists based on search and intent filter&#10;  const filteredDbQuestions = dbQuestions.filter(q =&gt; {&#10;    const matchQuery = searchQuery.trim() === &quot;&quot; || (q.name + &quot; &quot; + q.filled_prompt).toLowerCase().includes(searchQuery.toLowerCase())&#10;    const matchIntent = intentFilter === &quot;&quot; || q.intent === intentFilter&#10;    return matchQuery &amp;&amp; matchIntent&#10;  })&#10;&#10;  const filteredExpertQuestions = expertQuestions.filter(q =&gt; {&#10;    const matchQuery = searchQuery.trim() === &quot;&quot; || (q.name + &quot; &quot; + q.filled_prompt).toLowerCase().includes(searchQuery.toLowerCase())&#10;    const matchIntent = intentFilter === &quot;&quot; || q.intent === intentFilter&#10;    return matchQuery &amp;&amp; matchIntent&#10;  })&#10;&#10;  return (&#10;    &lt;div className=&quot;min-h-screen p-8 bg-gradient-to-br from-gray-50 to-gray-100/50&quot;&gt;&#10;      &lt;div className=&quot;mx-auto max-w-7xl space-y-6&quot;&gt;&#10;        &lt;div className=&quot;space-y-3&quot;&gt;&#10;          &lt;div className=&quot;flex items-center justify-between gap-4&quot;&gt;&#10;            &lt;div&gt;&#10;              &lt;h1 className=&quot;text-3xl font-bold&quot;&gt;Question Management&lt;/h1&gt;&#10;              &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Select questions from Database and Expert to create a new question set&lt;/p&gt;&#10;            &lt;/div&gt;&#10;            &lt;div className=&quot;hidden md:flex items-center gap-2&quot;&gt;&#10;              &lt;Input placeholder=&quot;Search questions...&quot; value={searchQuery} onChange={(e) =&gt; setSearchQuery(e.target.value)} className=&quot;w-[320px]&quot; /&gt;&#10;              &lt;select value={intentFilter} onChange={(e) =&gt; setIntentFilter(e.target.value)} className=&quot;text-sm border rounded px-2 py-1&quot;&gt;&#10;                &lt;option value=&quot;&quot;&gt;All intents&lt;/option&gt;&#10;                {allIntents.map(i =&gt; (&lt;option key={i} value={i}&gt;{i}&lt;/option&gt;))}&#10;              &lt;/select&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;          {/* mobile search */}&#10;          &lt;div className=&quot;md:hidden&quot;&gt;&#10;            &lt;Input placeholder=&quot;Search questions...&quot; value={searchQuery} onChange={(e) =&gt; setSearchQuery(e.target.value)} /&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div className=&quot;grid gap-6 lg:grid-cols-2&quot;&gt;&#10;          &lt;Card className=&quot;shadow-lg rounded-xl overflow-hidden&quot;&gt;&#10;            &lt;CardHeader&gt;&#10;              &lt;CardTitle&gt;Database Questions&lt;/CardTitle&gt;&#10;              &lt;CardDescription&gt;Mock list of all questions from the database&lt;/CardDescription&gt;&#10;            &lt;/CardHeader&gt;&#10;            &lt;CardContent className=&quot;p-4&quot;&gt;&#10;              &lt;div className=&quot;space-y-3 max-h-[520px] overflow-y-auto&quot;&gt;&#10;                {filteredDbQuestions.map((q) =&gt; (&#10;                  &lt;div key={q.id} className=&quot;flex items-start gap-3 p-3 rounded-lg bg-white hover:shadow-md transition transform hover:-translate-y-0.5&quot;&gt;&#10;                    &lt;div className=&quot;flex-1&quot;&gt;&#10;                      &lt;div className=&quot;flex items-center gap-3 mb-1 justify-between&quot;&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;Badge className={`text-xs ${intentColor(q.intent)}`}&gt;{q.intent}&lt;/Badge&gt;&#10;                          &lt;div className=&quot;font-medium&quot;&gt;{q.name}&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;div&gt;&#10;                          &lt;Button size=&quot;sm&quot; variant=&quot;ghost&quot; onClick={() =&gt; moveDbToExpert(q.id)}&gt;Add&lt;/Button&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div className=&quot;text-sm text-muted-foreground italic&quot;&gt;{q.filled_prompt}&lt;/div&gt;&#10;                      &lt;div className=&quot;text-xs text-muted-foreground mt-2&quot;&gt;ID: {q.id}&lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            &lt;/CardContent&gt;&#10;          &lt;/Card&gt;&#10;&#10;          &lt;Card className=&quot;shadow-lg rounded-xl overflow-hidden&quot;&gt;&#10;            &lt;CardHeader&gt;&#10;              &lt;CardTitle&gt;Expert Questions&lt;/CardTitle&gt;&#10;              &lt;CardDescription&gt;Questions generated by experts&lt;/CardDescription&gt;&#10;            &lt;/CardHeader&gt;&#10;            &lt;CardContent className=&quot;p-4&quot;&gt;&#10;              &lt;div className=&quot;space-y-3 max-h-[520px] overflow-y-auto&quot;&gt;&#10;                {filteredExpertQuestions.map((q) =&gt; (&#10;                  &lt;div&#10;                    key={q.id}&#10;                    draggable&#10;                    onDragStart={(e) =&gt; onDragStart(e, q.id)}&#10;                    onDragOver={onDragOver}&#10;                    onDrop={(e) =&gt; onDrop(e, q.id)}&#10;                    className={`flex items-start gap-3 p-3 rounded-lg bg-white hover:shadow-md transition transform ${draggedId === q.id ? &quot;opacity-60&quot; : &quot;hover:-translate-y-0.5&quot;}`}&gt;&#10;                    &lt;Checkbox id={`exp-${q.id}`} checked={expertSelected[q.id]} onCheckedChange={(v) =&gt; toggleExpert(q.id, v as boolean)} /&gt;&#10;&#10;                    &lt;div className=&quot;flex-1&quot;&gt;&#10;                      &lt;div className=&quot;flex items-center gap-2 mb-1 justify-between&quot;&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;Badge className={`text-xs ${intentColor(q.intent)}`}&gt;{q.intent}&lt;/Badge&gt;&#10;                          &lt;div className=&quot;font-medium&quot;&gt;{q.name}&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;DropdownMenu&gt;&#10;                            &lt;DropdownMenuTrigger asChild&gt;&#10;                              &lt;Button variant=&quot;ghost&quot; size=&quot;sm&quot; title=&quot;Actions&quot; className=&quot;w-8 h-8 rounded-full&quot;&gt;&#10;                                &lt;MoreHorizontal className=&quot;w-4 h-4&quot; /&gt;&#10;                              &lt;/Button&gt;&#10;                            &lt;/DropdownMenuTrigger&gt;&#10;                            &lt;DropdownMenuContent align=&quot;end&quot; className=&quot;w-52&quot;&gt;&#10;                              &lt;DropdownMenuLabel&gt;Actions&lt;/DropdownMenuLabel&gt;&#10;                              &lt;DropdownMenuSeparator /&gt;&#10;&#10;                              &lt;DropdownMenuItem onClick={() =&gt; startEdit(q)}&gt;&#10;                                &lt;Edit className=&quot;mr-2 h-4 w-4&quot; /&gt;&#10;                                Edit&#10;                              &lt;/DropdownMenuItem&gt;&#10;                              &lt;DropdownMenuItem onClick={() =&gt; promptMoveBack(q.id)} variant=&quot;destructive&quot;&gt;&#10;                                &lt;Trash2 className=&quot;mr-2 h-4 w-4&quot; /&gt;&#10;                                Delete&#10;                              &lt;/DropdownMenuItem&gt;&#10;                            &lt;/DropdownMenuContent&gt;&#10;                          &lt;/DropdownMenu&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;&#10;                      {editingId === q.id ? (&#10;                        &lt;div className=&quot;space-y-2&quot;&gt;&#10;                          &lt;Input value={editingData.name || &quot;&quot;} onChange={(e) =&gt; setEditingData(prev =&gt; ({ ...prev, name: e.target.value }))} /&gt;&#10;                          &lt;Textarea value={editingData.filled_prompt || &quot;&quot;} onChange={(e) =&gt; setEditingData(prev =&gt; ({ ...prev, filled_prompt: e.target.value }))} /&gt;&#10;                          &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                            &lt;Input value={editingData.intent || &quot;&quot;} onChange={(e) =&gt; setEditingData(prev =&gt; ({ ...prev, intent: e.target.value }))} placeholder=&quot;intent&quot; /&gt;&#10;                            &lt;Input value={editingData.question_type || &quot;&quot;} onChange={(e) =&gt; setEditingData(prev =&gt; ({ ...prev, question_type: e.target.value }))} placeholder=&quot;type&quot; /&gt;&#10;                          &lt;/div&gt;&#10;                          &lt;div className=&quot;flex gap-2 pt-2&quot;&gt;&#10;                            &lt;Button size=&quot;sm&quot; onClick={saveEdit} className=&quot;bg-green-600&quot;&gt;Save&lt;/Button&gt;&#10;                            &lt;Button size=&quot;sm&quot; onClick={cancelEdit} variant=&quot;outline&quot;&gt;Cancel&lt;/Button&gt;&#10;                          &lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                      ) : (&#10;                        &lt;&gt;&#10;                          &lt;div className=&quot;text-sm text-muted-foreground italic&quot;&gt;{q.filled_prompt}&lt;/div&gt;&#10;                          &lt;div className=&quot;text-xs text-muted-foreground mt-2&quot;&gt;ID: {q.id}&lt;/div&gt;&#10;                        &lt;/&gt;&#10;                      )}&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            &lt;/CardContent&gt;&#10;          &lt;/Card&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;Card&gt;&#10;          &lt;CardHeader&gt;&#10;            &lt;CardTitle&gt;Create New Question Set&lt;/CardTitle&gt;&#10;            &lt;CardDescription&gt;Enter name, description and create a question set from selected questions&lt;/CardDescription&gt;&#10;          &lt;/CardHeader&gt;&#10;          &lt;CardContent className=&quot;p-4 space-y-4&quot;&gt;&#10;            &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4&quot;&gt;&#10;              &lt;Input placeholder=&quot;Question set name&quot; value={name} onChange={(e) =&gt; setName(e.target.value)} /&gt;&#10;              &lt;Textarea placeholder=&quot;Description (optional)&quot; value={description} onChange={(e) =&gt; setDescription(e.target.value)} /&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div className=&quot;flex items-center justify-between&quot;&gt;&#10;              &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;Selected total: {(Object.values(expertSelected).filter(Boolean).length)} questions&lt;/div&gt;&#10;              &lt;Button onClick={createQuestionSet} className=&quot;bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700&quot;&gt;Create Question Set&lt;/Button&gt;&#10;            &lt;/div&gt;&#10;          &lt;/CardContent&gt;&#10;        &lt;/Card&gt;&#10;&#10;        &lt;Card className=&quot;shadow-md rounded-lg&quot;&gt;&#10;          &lt;CardHeader&gt;&#10;            &lt;CardTitle&gt;Selected Questions&lt;/CardTitle&gt;&#10;            &lt;CardDescription&gt;Preview of selected questions for the new set&lt;/CardDescription&gt;&#10;          &lt;/CardHeader&gt;&#10;          &lt;CardContent className=&quot;p-4&quot;&gt;&#10;            {selectedQuestions.length === 0 ? (&#10;              &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;No questions selected yet&lt;/div&gt;&#10;            ) : (&#10;              &lt;div&gt;&#10;                &lt;div className=&quot;flex items-center justify-between mb-4&quot;&gt;&#10;                  &lt;div&gt;&#10;                    &lt;div className=&quot;text-sm font-medium&quot;&gt;Question Set: {name || &quot;&lt;name&gt;&quot;}&lt;/div&gt;&#10;                    &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;{description}&lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;Total: &lt;span className=&quot;font-semibold text-700&quot;&gt;{selectedQuestions.length}&lt;/span&gt;&lt;/div&gt;&#10;                &lt;/div&gt;&#10;&#10;                &lt;div className=&quot;grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4&quot;&gt;&#10;                  {selectedQuestions.map((q) =&gt; (&#10;                    &lt;div key={q.id} className=&quot;bg-white border rounded-lg p-3 shadow-sm hover:shadow-md transition&quot;&gt;&#10;                      &lt;div className=&quot;flex items-start justify-between gap-2&quot;&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;Badge className={`text-xs ${intentColor(q.intent)}`}&gt;{q.intent}&lt;/Badge&gt;&#10;                          &lt;div className=&quot;font-medium&quot;&gt;{q.name}&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;div className=&quot;text-right&quot;&gt;&#10;                          {/* Drag handle hint */}&#10;                          &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;Drag to reorder&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;&#10;                      &lt;div className=&quot;mt-2 text-sm text-muted-foreground line-clamp-3&quot;&gt;{q.filled_prompt}&lt;/div&gt;&#10;                      &lt;div className=&quot;mt-3 flex items-center justify-between text-xs text-muted-foreground&quot;&gt;&#10;                        &lt;div&gt;ID: &lt;span className=&quot;font-mono text-[11px]&quot;&gt;{q.id.slice(0,8)}…&lt;/span&gt;&lt;/div&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;Type: &lt;span className=&quot;font-medium&quot;&gt;{q.question_type}&lt;/span&gt;&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            )}&#10;          &lt;/CardContent&gt;&#10;        &lt;/Card&gt;&#10;&#10;        {/* New: Saved Question Sets list (bottom box) */}&#10;        &lt;Card className=&quot;mt-4&quot;&gt;&#10;          &lt;CardHeader&gt;&#10;            &lt;CardTitle&gt;Saved Question Sets&lt;/CardTitle&gt;&#10;            &lt;CardDescription&gt;List of created question sets (preview)&lt;/CardDescription&gt;&#10;          &lt;/CardHeader&gt;&#10;          &lt;CardContent className=&quot;p-4&quot;&gt;&#10;            {questionSets.length === 0 ? (&#10;              &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;No saved question sets yet&lt;/div&gt;&#10;            ) : (&#10;              &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4&quot;&gt;&#10;                {questionSets.map((set) =&gt; (&#10;                  &lt;div key={set.id} className=&quot;bg-white border rounded-lg p-4 shadow-sm hover:shadow-md transition&quot;&gt;&#10;                    &lt;div className=&quot;flex items-start justify-between gap-4&quot;&gt;&#10;                      &lt;div&gt;&#10;                        &lt;div className=&quot;text-sm font-semibold&quot;&gt;{set.name}&lt;/div&gt;&#10;                        &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;{set.description || &lt;span className=&quot;italic text-muted-foreground&quot;&gt;No description&lt;/span&gt;}&lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div className=&quot;flex flex-col items-end gap-2&quot;&gt;&#10;                        &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;{set.questionIds.length} questions&lt;/div&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;Button size=&quot;sm&quot; variant=&quot;ghost&quot; onClick={() =&gt; navigator.clipboard.writeText(set.id)}&gt;Copy ID&lt;/Button&gt;&#10;                          &lt;Button size=&quot;sm&quot; variant=&quot;destructive&quot; onClick={() =&gt; deleteQuestionSet(set.id)}&gt;Delete&lt;/Button&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div className=&quot;mt-3 flex flex-wrap gap-2&quot;&gt;&#10;                      {set.questionIds.map((qid) =&gt; {&#10;                        const q = getQuestionById(qid)&#10;                        return (&#10;                          &lt;div key={qid} className=&quot;px-3 py-1 rounded-full bg-gray-100 text-sm flex items-center gap-2&quot;&gt;&#10;                            &lt;Badge className=&quot;bg-gray-200 text-xs&quot;&gt;{q?.intent ?? &quot;-&quot;}&lt;/Badge&gt;&#10;                            &lt;div className=&quot;truncate max-w-[160px]&quot;&gt;{q?.name ?? qid}&lt;/div&gt;&#10;                          &lt;/div&gt;&#10;                        )&#10;                      })}&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            )}&#10;          &lt;/CardContent&gt;&#10;        &lt;/Card&gt;&#10;&#10;        {/* Centered modal confirmation for delete/move-back */}&#10;        {pendingMoveId &amp;&amp; (() =&gt; {&#10;          const q = expertQuestions.find(x =&gt; x.id === pendingMoveId) || dbQuestions.find(x =&gt; x.id === pendingMoveId)&#10;          return (&#10;            &lt;div className=&quot;fixed inset-0 z-50 flex items-center justify-center&quot;&gt;&#10;              &lt;div className=&quot;absolute inset-0 bg-black/40&quot; onClick={() =&gt; setPendingMoveId(null)} /&gt;&#10;&#10;              &lt;div className=&quot;relative w-full max-w-lg px-4&quot;&gt;&#10;                &lt;Card className=&quot;shadow-2xl&quot;&gt;&#10;                  &lt;CardHeader&gt;&#10;                    &lt;CardTitle&gt;Delete Question&lt;/CardTitle&gt;&#10;                    &lt;CardDescription&gt;Are you sure you want to delete this question?&lt;/CardDescription&gt;&#10;                  &lt;/CardHeader&gt;&#10;                  &lt;CardContent&gt;&#10;                    {q ? (&#10;                      &lt;div className=&quot;space-y-4&quot;&gt;&#10;                        &lt;div className=&quot;font-medium text-lg&quot;&gt;{q.name}&lt;/div&gt;&#10;                        &lt;div className=&quot;text-sm text-muted-foreground italic line-clamp-3&quot;&gt;{q.filled_prompt}&lt;/div&gt;&#10;                        &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;ID: &lt;span className=&quot;font-mono&quot;&gt;{q.id}&lt;/span&gt;&lt;/div&gt;&#10;&#10;                        &lt;div className=&quot;flex items-center justify-end gap-3 pt-4&quot;&gt;&#10;                          &lt;Button variant=&quot;outline&quot; onClick={() =&gt; setPendingMoveId(null)}&gt;Cancel&lt;/Button&gt;&#10;                          &lt;Button className=&quot;bg-red-600&quot; onClick={() =&gt; { if (pendingMoveId) deleteExpertQuestion(pendingMoveId); setPendingMoveId(null) }}&gt;Delete&lt;/Button&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                    ) : (&#10;                      &lt;div&gt;Question not found.&lt;/div&gt;&#10;                    )}&#10;                  &lt;/CardContent&gt;&#10;                &lt;/Card&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;          )&#10;        })()}&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  )&#10;}&#10;" />
              <option name="updatedContent" value="&quot;use client&quot;&#10;&#10;import React, { useState, useEffect } from &quot;react&quot;&#10;import { Card, CardContent, CardHeader, CardTitle, CardDescription } from &quot;@/components/ui/card&quot;&#10;import { Button } from &quot;@/components/ui/button&quot;&#10;import { Checkbox } from &quot;@/components/ui/checkbox&quot;&#10;import { Input } from &quot;@/components/ui/input&quot;&#10;import { Textarea } from &quot;@/components/ui/textarea&quot;&#10;import { Badge } from &quot;@/components/ui/badge&quot;&#10;import { useToast } from &quot;@/hooks/use-toast&quot;&#10;import { Edit, Trash2, MoreHorizontal } from &quot;lucide-react&quot;&#10;import {&#10;  DropdownMenu,&#10;  DropdownMenuTrigger,&#10;  DropdownMenuContent,&#10;  DropdownMenuItem,&#10;  DropdownMenuLabel,&#10;  DropdownMenuSeparator,&#10;} from &quot;@/components/ui/dropdown-menu&quot;&#10;&#10;interface Question {&#10;  id: string&#10;  name: string&#10;  intent: string&#10;  filled_prompt: string&#10;  question_type: string&#10;}&#10;&#10;const MOCK_DB_QUESTIONS: Question[] = [&#10;  {&#10;    id: &quot;T_FREQ_01&quot;,&#10;    name: &quot;Tần suất thực hiện hành động 1&quot;,&#10;    intent: &quot;frequency&quot;,&#10;    filled_prompt: `Người có tính cách O, giới tính Nam, độ tuổi 18, mức độ yêu thích hành động khám phá quán cafe Đà Nẵng mới là như thế nào?\nLoại câu trả lời: frequency\n1: Không bao giờ\n2: Thỉnh thoảng\n3: Thường xuyên\n4: Rất thường xuyên`,&#10;    question_type: &quot;frequency&quot;,&#10;  },&#10;  {&#10;    id: &quot;T_FREQ_02&quot;,&#10;    name: &quot;Tần suất thực hiện hành động 2&quot;,&#10;    intent: &quot;frequency&quot;,&#10;    filled_prompt: `Người có tính cách O, thường thực hiện hành động khám phá quán cafe Đà Nẵng mới với tần suất nào?\nLoại câu trả lời: frequency\n1: Không bao giờ\n2: Thỉnh thoảng\n3: Thường xuyên\n4: Rất thường xuyên`,&#10;    question_type: &quot;frequency&quot;,&#10;  },&#10;  {&#10;    id: &quot;T_YN_01&quot;,&#10;    name: &quot;Thói quen hành động 1&quot;,&#10;    intent: &quot;yesno&quot;,&#10;    filled_prompt: `Người có tính cách O, giới tính Nam, độ tuổi 18, có thực hiện khám phá quán cafe Đà Nẵng mới không?\nLoại câu trả lời: yesno\nCó\nKhông`,&#10;    question_type: &quot;yesno&quot;,&#10;  },&#10;]&#10;&#10;export default function ManageQuestionsPage() {&#10;  // DB questions are editable: start from mock DB. Expert list starts empty.&#10;  const [dbQuestions, setDbQuestions] = useState&lt;Question[]&gt;(MOCK_DB_QUESTIONS)&#10;  const [expertSelected, setExpertSelected] = useState&lt;Record&lt;string, boolean&gt;&gt;({})&#10;  const [name, setName] = useState(&quot;&quot;)&#10;  const [description, setDescription] = useState(&quot;&quot;)&#10;  // UI polish: search and filter for enterprise UX&#10;  const [searchQuery, setSearchQuery] = useState(&quot;&quot;)&#10;  const [intentFilter, setIntentFilter] = useState(&quot;&quot;)&#10;  const { toast } = useToast()&#10;&#10;  // drag-and-drop ordering state for Expert Questions&#10;  const [draggedId, setDraggedId] = useState&lt;string | null&gt;(null)&#10;&#10;  const onDragStart = (e: React.DragEvent&lt;HTMLDivElement&gt;, id: string) =&gt; {&#10;    setDraggedId(id)&#10;    e.dataTransfer.effectAllowed = &quot;move&quot;&#10;    try { e.dataTransfer.setData(&quot;text/plain&quot;, id) } catch (err) { /* some browsers require try/catch */ }&#10;  }&#10;&#10;  const onDragOver = (e: React.DragEvent&lt;HTMLDivElement&gt;) =&gt; {&#10;    e.preventDefault()&#10;    e.dataTransfer.dropEffect = &quot;move&quot;&#10;  }&#10;&#10;  const onDrop = (e: React.DragEvent&lt;HTMLDivElement&gt;, targetId: string) =&gt; {&#10;    e.preventDefault()&#10;    const sourceId = draggedId || e.dataTransfer.getData(&quot;text/plain&quot;)&#10;    if (!sourceId || sourceId === targetId) {&#10;      setDraggedId(null)&#10;      return&#10;    }&#10;&#10;    setExpertQuestions(prev =&gt; {&#10;      const copy = [...prev]&#10;      const fromIndex = copy.findIndex(x =&gt; x.id === sourceId)&#10;      const toIndex = copy.findIndex(x =&gt; x.id === targetId)&#10;      if (fromIndex === -1 || toIndex === -1) return prev&#10;      const [moved] = copy.splice(fromIndex, 1)&#10;      copy.splice(toIndex, 0, moved)&#10;      return copy&#10;    })&#10;&#10;    setDraggedId(null)&#10;  }&#10;&#10;  // New state: questions-manage expert questions list so we can edit/delete/reorder&#10;  const [expertQuestions, setExpertQuestions] = useState&lt;Question[]&gt;([])&#10;  const [editingId, setEditingId] = useState&lt;string | null&gt;(null)&#10;  const [editingData, setEditingData] = useState&lt;Partial&lt;Question&gt;&gt;({})&#10;&#10;  // New state: saved question sets created from selections&#10;  const [questionSets, setQuestionSets] = useState&lt;{&#10;    id: string&#10;    name: string&#10;    description: string&#10;    questionIds: string[]&#10;  }[]&gt;([])&#10;&#10;  // Load saved question sets from localStorage on mount&#10;  useEffect(() =&gt; {&#10;    try {&#10;      const raw = localStorage.getItem(&quot;questionSets&quot;)&#10;      if (raw) {&#10;        const parsed = JSON.parse(raw)&#10;        if (Array.isArray(parsed)) setQuestionSets(parsed)&#10;      }&#10;    } catch (e) {&#10;      console.warn(&quot;Failed to load saved question sets from localStorage&quot;, e)&#10;    }&#10;  }, [])&#10;&#10;  // Persist questionSets to localStorage whenever it changes&#10;  useEffect(() =&gt; {&#10;    try {&#10;      localStorage.setItem(&quot;questionSets&quot;, JSON.stringify(questionSets))&#10;    } catch (e) {&#10;      console.warn(&quot;Failed to save question sets to localStorage&quot;, e)&#10;    }&#10;  }, [questionSets])&#10;&#10;  const toggleExpert = (id: string, value: boolean) =&gt; {&#10;    setExpertSelected(prev =&gt; ({ ...prev, [id]: value }))&#10;  }&#10;&#10;  // Move a DB question into Expert questions for editing/rating&#10;  const moveDbToExpert = (id: string) =&gt; {&#10;    const q = dbQuestions.find(d =&gt; d.id === id)&#10;    if (!q) return&#10;    setExpertQuestions(prev =&gt; [q, ...prev])&#10;    setDbQuestions(prev =&gt; prev.filter(d =&gt; d.id !== id))&#10;    // remove any lingering selection state&#10;    setExpertSelected(prev =&gt; ({ ...prev }))&#10;    toast({ title: &quot;Moved&quot;, description: `Question moved to Expert list` })&#10;  }&#10;&#10;  const createQuestionSet = () =&gt; {&#10;    // After DB questions are moved to Expert list, only Expert-side selections apply&#10;    const selectedExpertIds = Object.entries(expertSelected).filter(([_, v]) =&gt; v).map(([k]) =&gt; k)&#10;    const questionIds = [...selectedExpertIds]&#10;&#10;    if (name.trim() === &quot;&quot;) {&#10;      toast({ title: &quot;Error&quot;, description: &quot;Please enter a name for the question set&quot;, variant: &quot;destructive&quot; })&#10;      return&#10;    }&#10;&#10;    if (questionIds.length === 0) {&#10;      toast({ title: &quot;Error&quot;, description: &quot;Please select at least one question&quot;, variant: &quot;destructive&quot; })&#10;      return&#10;    }&#10;&#10;    const newSet = {&#10;      id: `${Date.now()}`,&#10;      name: name.trim(),&#10;      description: description.trim(),&#10;      questionIds,&#10;    }&#10;&#10;    // Save the set locally (replace with API call if needed)&#10;    setQuestionSets(prev =&gt; [newSet, ...prev])&#10;&#10;    toast({ title: &quot;Success&quot;, description: `Question set &quot;${newSet.name}&quot; created (${questionIds.length} questions)` })&#10;&#10;    // Reset form and only unselect the questions that were used in the created set&#10;    setName(&quot;&quot;)&#10;    setDescription(&quot;&quot;)&#10;&#10;    setExpertSelected(prev =&gt; {&#10;      const copy = { ...prev }&#10;      selectedExpertIds.forEach(id =&gt; {&#10;        if (id in copy) delete copy[id]&#10;      })&#10;      return copy&#10;    })&#10;  }&#10;&#10;  // delete saved question set&#10;  const deleteQuestionSet = (id: string) =&gt; {&#10;    if (!window.confirm(&quot;Delete this question set?&quot;)) return&#10;    setQuestionSets(prev =&gt; prev.filter(s =&gt; s.id !== id))&#10;    toast({ title: &quot;Deleted&quot;, description: &quot;Question set removed&quot; })&#10;  }&#10;&#10;  // Expert question actions&#10;  const [pendingMoveId, setPendingMoveId] = useState&lt;string | null&gt;(null)&#10;&#10;  // perform the actual move from Expert back to DB&#10;  const deleteExpertQuestion = (id: string) =&gt; {&#10;    // find question in expert list&#10;    const q = expertQuestions.find(q =&gt; q.id === id)&#10;    if (q) {&#10;      // add back to DB questions at the top&#10;      setDbQuestions(prev =&gt; [q, ...prev])&#10;    }&#10;&#10;    // remove from expert list&#10;    setExpertQuestions(prev =&gt; prev.filter(q =&gt; q.id !== id))&#10;&#10;    // remove any expert selection state&#10;    setExpertSelected(prev =&gt; {&#10;      const copy = { ...prev }&#10;      delete copy[id]&#10;      return copy&#10;    })&#10;&#10;    toast({ title: &quot;Moved&quot;, description: &quot;Question moved back to Database Questions&quot; })&#10;  }&#10;&#10;  const promptMoveBack = (id: string) =&gt; {&#10;    setPendingMoveId(id)&#10;  }&#10;&#10;  const startEdit = (q: Question) =&gt; {&#10;    setEditingId(q.id)&#10;    setEditingData({ ...q })&#10;  }&#10;&#10;  const cancelEdit = () =&gt; {&#10;    setEditingId(null)&#10;    setEditingData({})&#10;  }&#10;&#10;  const saveEdit = () =&gt; {&#10;    if (!editingId) return&#10;    setExpertQuestions(prev =&gt; prev.map(q =&gt; (q.id === editingId ? { ...(q as Question), ...(editingData as Question) } : q)))&#10;    setEditingId(null)&#10;    setEditingData({})&#10;    toast({ title: &quot;Saved&quot;, description: &quot;Expert question has been updated&quot; })&#10;  }&#10;&#10;  // Compute selected question objects for preview&#10;  const selectedExpertQuestions = expertQuestions.filter(q =&gt; expertSelected[q.id])&#10;  const selectedQuestions = [...selectedExpertQuestions]&#10;&#10;  // helper to get question name by id&#10;  const getQuestionById = (id: string) =&gt; {&#10;    return dbQuestions.concat(expertQuestions).find(q =&gt; q.id === id)&#10;  }&#10;&#10;  // helper: map intent to badge color classes&#10;  const intentColor = (intent?: string) =&gt; {&#10;    switch (intent) {&#10;      case &quot;frequency&quot;:&#10;        return &quot;bg-blue-100 text-blue-800&quot;&#10;      case &quot;yesno&quot;:&#10;        return &quot;bg-green-100 text-green-800&quot;&#10;      case &quot;rating&quot;:&#10;        return &quot;bg-yellow-100 text-yellow-800&quot;&#10;      case &quot;choice&quot;:&#10;        return &quot;bg-indigo-100 text-indigo-800&quot;&#10;      case &quot;binary&quot;:&#10;        return &quot;bg-rose-100 text-rose-800&quot;&#10;      default:&#10;        return &quot;bg-gray-200 text-gray-800&quot;&#10;    }&#10;  }&#10;&#10;  // compute intents for filter select&#10;  const allIntents = Array.from(new Set(dbQuestions.concat(expertQuestions).map(q =&gt; q.intent))).filter(Boolean)&#10;&#10;  // filtered lists based on search and intent filter&#10;  const filteredDbQuestions = dbQuestions.filter(q =&gt; {&#10;    const matchQuery = searchQuery.trim() === &quot;&quot; || (q.name + &quot; &quot; + q.filled_prompt).toLowerCase().includes(searchQuery.toLowerCase())&#10;    const matchIntent = intentFilter === &quot;&quot; || q.intent === intentFilter&#10;    return matchQuery &amp;&amp; matchIntent&#10;  })&#10;&#10;  const filteredExpertQuestions = expertQuestions.filter(q =&gt; {&#10;    const matchQuery = searchQuery.trim() === &quot;&quot; || (q.name + &quot; &quot; + q.filled_prompt).toLowerCase().includes(searchQuery.toLowerCase())&#10;    const matchIntent = intentFilter === &quot;&quot; || q.intent === intentFilter&#10;    return matchQuery &amp;&amp; matchIntent&#10;  })&#10;&#10;  return (&#10;    &lt;div className=&quot;min-h-screen p-8 bg-gradient-to-br from-gray-50 to-gray-100/50&quot;&gt;&#10;      &lt;div className=&quot;mx-auto max-w-7xl space-y-6&quot;&gt;&#10;        &lt;div className=&quot;space-y-3&quot;&gt;&#10;          &lt;div className=&quot;flex items-center justify-between gap-4&quot;&gt;&#10;            &lt;div&gt;&#10;              &lt;h1 className=&quot;text-3xl font-bold&quot;&gt;Question Management&lt;/h1&gt;&#10;              &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Select questions from Database and Expert to create a new question set&lt;/p&gt;&#10;            &lt;/div&gt;&#10;            &lt;div className=&quot;hidden md:flex items-center gap-2&quot;&gt;&#10;              &lt;Input placeholder=&quot;Search questions...&quot; value={searchQuery} onChange={(e) =&gt; setSearchQuery(e.target.value)} className=&quot;w-[320px]&quot; /&gt;&#10;              &lt;select value={intentFilter} onChange={(e) =&gt; setIntentFilter(e.target.value)} className=&quot;text-sm border rounded px-2 py-1&quot;&gt;&#10;                &lt;option value=&quot;&quot;&gt;All intents&lt;/option&gt;&#10;                {allIntents.map(i =&gt; (&lt;option key={i} value={i}&gt;{i}&lt;/option&gt;))}&#10;              &lt;/select&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;          {/* mobile search */}&#10;          &lt;div className=&quot;md:hidden&quot;&gt;&#10;            &lt;Input placeholder=&quot;Search questions...&quot; value={searchQuery} onChange={(e) =&gt; setSearchQuery(e.target.value)} /&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div className=&quot;grid gap-6 lg:grid-cols-2&quot;&gt;&#10;          &lt;Card className=&quot;shadow-lg rounded-xl overflow-hidden&quot;&gt;&#10;            &lt;CardHeader&gt;&#10;              &lt;CardTitle&gt;Database Questions&lt;/CardTitle&gt;&#10;              &lt;CardDescription&gt;Mock list of all questions from the database&lt;/CardDescription&gt;&#10;            &lt;/CardHeader&gt;&#10;            &lt;CardContent className=&quot;p-4&quot;&gt;&#10;              &lt;div className=&quot;space-y-3 max-h-[520px] overflow-y-auto&quot;&gt;&#10;                {filteredDbQuestions.map((q) =&gt; (&#10;                  &lt;div key={q.id} className=&quot;flex items-start gap-3 p-3 rounded-lg bg-white hover:shadow-md transition transform hover:-translate-y-0.5&quot;&gt;&#10;                    &lt;div className=&quot;flex-1&quot;&gt;&#10;                      &lt;div className=&quot;flex items-center gap-3 mb-1 justify-between&quot;&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;Badge className={`text-xs ${intentColor(q.intent)}`}&gt;{q.intent}&lt;/Badge&gt;&#10;                          &lt;div className=&quot;font-medium&quot;&gt;{q.name}&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;div&gt;&#10;                          &lt;Button size=&quot;sm&quot; variant=&quot;ghost&quot; onClick={() =&gt; moveDbToExpert(q.id)}&gt;Add&lt;/Button&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div className=&quot;text-sm text-muted-foreground italic&quot;&gt;{q.filled_prompt}&lt;/div&gt;&#10;                      &lt;div className=&quot;text-xs text-muted-foreground mt-2&quot;&gt;ID: {q.id}&lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            &lt;/CardContent&gt;&#10;          &lt;/Card&gt;&#10;&#10;          &lt;Card className=&quot;shadow-lg rounded-xl overflow-hidden&quot;&gt;&#10;            &lt;CardHeader&gt;&#10;              &lt;CardTitle&gt;Expert Questions&lt;/CardTitle&gt;&#10;              &lt;CardDescription&gt;Questions generated by experts&lt;/CardDescription&gt;&#10;            &lt;/CardHeader&gt;&#10;            &lt;CardContent className=&quot;p-4&quot;&gt;&#10;              &lt;div className=&quot;space-y-3 max-h-[520px] overflow-y-auto&quot;&gt;&#10;                {filteredExpertQuestions.map((q) =&gt; (&#10;                  &lt;div&#10;                    key={q.id}&#10;                    draggable&#10;                    onDragStart={(e) =&gt; onDragStart(e, q.id)}&#10;                    onDragOver={onDragOver}&#10;                    onDrop={(e) =&gt; onDrop(e, q.id)}&#10;                    className={`flex items-start gap-3 p-3 rounded-lg bg-white hover:shadow-md transition transform ${draggedId === q.id ? &quot;opacity-60&quot; : &quot;hover:-translate-y-0.5&quot;}`}&gt;&#10;                    &lt;Checkbox id={`exp-${q.id}`} checked={expertSelected[q.id]} onCheckedChange={(v) =&gt; toggleExpert(q.id, v as boolean)} /&gt;&#10;&#10;                    &lt;div className=&quot;flex-1&quot;&gt;&#10;                      &lt;div className=&quot;flex items-center gap-2 mb-1 justify-between&quot;&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;Badge className={`text-xs ${intentColor(q.intent)}`}&gt;{q.intent}&lt;/Badge&gt;&#10;                          &lt;div className=&quot;font-medium&quot;&gt;{q.name}&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;DropdownMenu&gt;&#10;                            &lt;DropdownMenuTrigger asChild&gt;&#10;                              &lt;Button variant=&quot;ghost&quot; size=&quot;sm&quot; title=&quot;Actions&quot; className=&quot;w-8 h-8 rounded-full&quot;&gt;&#10;                                &lt;MoreHorizontal className=&quot;w-4 h-4&quot; /&gt;&#10;                              &lt;/Button&gt;&#10;                            &lt;/DropdownMenuTrigger&gt;&#10;                            &lt;DropdownMenuContent align=&quot;end&quot; className=&quot;w-52&quot;&gt;&#10;                              &lt;DropdownMenuLabel&gt;Actions&lt;/DropdownMenuLabel&gt;&#10;                              &lt;DropdownMenuSeparator /&gt;&#10;&#10;                              &lt;DropdownMenuItem onClick={() =&gt; startEdit(q)}&gt;&#10;                                &lt;Edit className=&quot;mr-2 h-4 w-4&quot; /&gt;&#10;                                Edit&#10;                              &lt;/DropdownMenuItem&gt;&#10;                              &lt;DropdownMenuItem onClick={() =&gt; promptMoveBack(q.id)} variant=&quot;destructive&quot;&gt;&#10;                                &lt;Trash2 className=&quot;mr-2 h-4 w-4&quot; /&gt;&#10;                                Delete&#10;                              &lt;/DropdownMenuItem&gt;&#10;                            &lt;/DropdownMenuContent&gt;&#10;                          &lt;/DropdownMenu&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;&#10;                      {editingId === q.id ? (&#10;                        &lt;div className=&quot;space-y-2&quot;&gt;&#10;                          &lt;Input value={editingData.name || &quot;&quot;} onChange={(e) =&gt; setEditingData(prev =&gt; ({ ...prev, name: e.target.value }))} /&gt;&#10;                          &lt;Textarea value={editingData.filled_prompt || &quot;&quot;} onChange={(e) =&gt; setEditingData(prev =&gt; ({ ...prev, filled_prompt: e.target.value }))} /&gt;&#10;                          &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                            &lt;Input value={editingData.intent || &quot;&quot;} onChange={(e) =&gt; setEditingData(prev =&gt; ({ ...prev, intent: e.target.value }))} placeholder=&quot;intent&quot; /&gt;&#10;                            &lt;Input value={editingData.question_type || &quot;&quot;} onChange={(e) =&gt; setEditingData(prev =&gt; ({ ...prev, question_type: e.target.value }))} placeholder=&quot;type&quot; /&gt;&#10;                          &lt;/div&gt;&#10;                          &lt;div className=&quot;flex gap-2 pt-2&quot;&gt;&#10;                            &lt;Button size=&quot;sm&quot; onClick={saveEdit} className=&quot;bg-green-600&quot;&gt;Save&lt;/Button&gt;&#10;                            &lt;Button size=&quot;sm&quot; onClick={cancelEdit} variant=&quot;outline&quot;&gt;Cancel&lt;/Button&gt;&#10;                          &lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                      ) : (&#10;                        &lt;&gt;&#10;                          &lt;div className=&quot;text-sm text-muted-foreground italic&quot;&gt;{q.filled_prompt}&lt;/div&gt;&#10;                          &lt;div className=&quot;text-xs text-muted-foreground mt-2&quot;&gt;ID: {q.id}&lt;/div&gt;&#10;                        &lt;/&gt;&#10;                      )}&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            &lt;/CardContent&gt;&#10;          &lt;/Card&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;Card&gt;&#10;          &lt;CardHeader&gt;&#10;            &lt;CardTitle&gt;Create New Question Set&lt;/CardTitle&gt;&#10;            &lt;CardDescription&gt;Enter name, description and create a question set from selected questions&lt;/CardDescription&gt;&#10;          &lt;/CardHeader&gt;&#10;          &lt;CardContent className=&quot;p-4 space-y-4&quot;&gt;&#10;            &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4&quot;&gt;&#10;              &lt;Input placeholder=&quot;Question set name&quot; value={name} onChange={(e) =&gt; setName(e.target.value)} /&gt;&#10;              &lt;Textarea placeholder=&quot;Description (optional)&quot; value={description} onChange={(e) =&gt; setDescription(e.target.value)} /&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div className=&quot;flex items-center justify-between&quot;&gt;&#10;              &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;Selected total: {(Object.values(expertSelected).filter(Boolean).length)} questions&lt;/div&gt;&#10;              &lt;Button onClick={createQuestionSet} className=&quot;bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700&quot;&gt;Create Question Set&lt;/Button&gt;&#10;            &lt;/div&gt;&#10;          &lt;/CardContent&gt;&#10;        &lt;/Card&gt;&#10;&#10;        &lt;Card className=&quot;shadow-md rounded-lg&quot;&gt;&#10;          &lt;CardHeader&gt;&#10;            &lt;CardTitle&gt;Selected Questions&lt;/CardTitle&gt;&#10;            &lt;CardDescription&gt;Preview of selected questions for the new set&lt;/CardDescription&gt;&#10;          &lt;/CardHeader&gt;&#10;          &lt;CardContent className=&quot;p-4&quot;&gt;&#10;            {selectedQuestions.length === 0 ? (&#10;              &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;No questions selected yet&lt;/div&gt;&#10;            ) : (&#10;              &lt;div&gt;&#10;                &lt;div className=&quot;flex items-center justify-between mb-4&quot;&gt;&#10;                  &lt;div&gt;&#10;                    &lt;div className=&quot;text-sm font-medium&quot;&gt;Question Set: {name || &quot;&lt;name&gt;&quot;}&lt;/div&gt;&#10;                    &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;{description}&lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;Total: &lt;span className=&quot;font-semibold text-700&quot;&gt;{selectedQuestions.length}&lt;/span&gt;&lt;/div&gt;&#10;                &lt;/div&gt;&#10;&#10;                &lt;div className=&quot;grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4&quot;&gt;&#10;                  {selectedQuestions.map((q) =&gt; (&#10;                    &lt;div key={q.id} className=&quot;bg-white border rounded-lg p-3 shadow-sm hover:shadow-md transition&quot;&gt;&#10;                      &lt;div className=&quot;flex items-start justify-between gap-2&quot;&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;Badge className={`text-xs ${intentColor(q.intent)}`}&gt;{q.intent}&lt;/Badge&gt;&#10;                          &lt;div className=&quot;font-medium&quot;&gt;{q.name}&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;div className=&quot;text-right&quot;&gt;&#10;                          {/* Drag handle hint */}&#10;                          &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;Drag to reorder&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;&#10;                      &lt;div className=&quot;mt-2 text-sm text-muted-foreground line-clamp-3&quot;&gt;{q.filled_prompt}&lt;/div&gt;&#10;                      &lt;div className=&quot;mt-3 flex items-center justify-between text-xs text-muted-foreground&quot;&gt;&#10;                        &lt;div&gt;ID: &lt;span className=&quot;font-mono text-[11px]&quot;&gt;{q.id.slice(0,8)}…&lt;/span&gt;&lt;/div&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;Type: &lt;span className=&quot;font-medium&quot;&gt;{q.question_type}&lt;/span&gt;&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            )}&#10;          &lt;/CardContent&gt;&#10;        &lt;/Card&gt;&#10;&#10;        {/* New: Saved Question Sets list (bottom box) */}&#10;        &lt;Card className=&quot;mt-4&quot;&gt;&#10;          &lt;CardHeader&gt;&#10;            &lt;CardTitle&gt;Saved Question Sets&lt;/CardTitle&gt;&#10;            &lt;CardDescription&gt;List of created question sets (preview)&lt;/CardDescription&gt;&#10;          &lt;/CardHeader&gt;&#10;          &lt;CardContent className=&quot;p-4&quot;&gt;&#10;            {questionSets.length === 0 ? (&#10;              &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;No saved question sets yet&lt;/div&gt;&#10;            ) : (&#10;              &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4&quot;&gt;&#10;                {questionSets.map((set) =&gt; (&#10;                  &lt;div key={set.id} className=&quot;bg-white border rounded-lg p-4 shadow-sm hover:shadow-md transition&quot;&gt;&#10;                    &lt;div className=&quot;flex items-start justify-between gap-4&quot;&gt;&#10;                      &lt;div&gt;&#10;                        &lt;div className=&quot;text-sm font-semibold&quot;&gt;{set.name}&lt;/div&gt;&#10;                        &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;{set.description || &lt;span className=&quot;italic text-muted-foreground&quot;&gt;No description&lt;/span&gt;}&lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div className=&quot;flex flex-col items-end gap-2&quot;&gt;&#10;                        &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;{set.questionIds.length} questions&lt;/div&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;Button size=&quot;sm&quot; variant=&quot;ghost&quot; onClick={() =&gt; navigator.clipboard.writeText(set.id)}&gt;Copy ID&lt;/Button&gt;&#10;                          &lt;Button size=&quot;sm&quot; variant=&quot;destructive&quot; onClick={() =&gt; deleteQuestionSet(set.id)}&gt;Delete&lt;/Button&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div className=&quot;mt-3 flex flex-wrap gap-2&quot;&gt;&#10;                      {set.questionIds.map((qid) =&gt; {&#10;                        const q = getQuestionById(qid)&#10;                        return (&#10;                          &lt;div key={qid} className=&quot;px-3 py-1 rounded-full bg-gray-100 text-sm flex items-center gap-2&quot;&gt;&#10;                            &lt;Badge className=&quot;bg-gray-200 text-xs&quot;&gt;{q?.intent ?? &quot;-&quot;}&lt;/Badge&gt;&#10;                            &lt;div className=&quot;truncate max-w-[160px]&quot;&gt;{q?.name ?? qid}&lt;/div&gt;&#10;                          &lt;/div&gt;&#10;                        )&#10;                      })}&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            )}&#10;          &lt;/CardContent&gt;&#10;        &lt;/Card&gt;&#10;&#10;        {/* Centered modal confirmation for delete/move-back */}&#10;        {pendingMoveId &amp;&amp; (() =&gt; {&#10;          const q = expertQuestions.find(x =&gt; x.id === pendingMoveId) || dbQuestions.find(x =&gt; x.id === pendingMoveId)&#10;          return (&#10;            &lt;div className=&quot;fixed inset-0 z-50 flex items-center justify-center&quot;&gt;&#10;              &lt;div className=&quot;absolute inset-0 bg-black/40&quot; onClick={() =&gt; setPendingMoveId(null)} /&gt;&#10;&#10;              &lt;div className=&quot;relative w-full max-w-lg px-4&quot;&gt;&#10;                &lt;Card className=&quot;shadow-2xl&quot;&gt;&#10;                  &lt;CardHeader&gt;&#10;                    &lt;CardTitle&gt;Delete Question&lt;/CardTitle&gt;&#10;                    &lt;CardDescription&gt;Are you sure you want to delete this question?&lt;/CardDescription&gt;&#10;                  &lt;/CardHeader&gt;&#10;                  &lt;CardContent&gt;&#10;                    {q ? (&#10;                      &lt;div className=&quot;space-y-4&quot;&gt;&#10;                        &lt;div className=&quot;font-medium text-lg&quot;&gt;{q.name}&lt;/div&gt;&#10;                        &lt;div className=&quot;text-sm text-muted-foreground italic line-clamp-3&quot;&gt;{q.filled_prompt}&lt;/div&gt;&#10;                        &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;ID: &lt;span className=&quot;font-mono&quot;&gt;{q.id}&lt;/span&gt;&lt;/div&gt;&#10;&#10;                        &lt;div className=&quot;flex items-center justify-end gap-3 pt-4&quot;&gt;&#10;                          &lt;Button variant=&quot;outline&quot; onClick={() =&gt; setPendingMoveId(null)}&gt;Cancel&lt;/Button&gt;&#10;                          &lt;Button className=&quot;bg-red-600&quot; onClick={() =&gt; { if (pendingMoveId) deleteExpertQuestion(pendingMoveId); setPendingMoveId(null) }}&gt;Delete&lt;/Button&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                    ) : (&#10;                      &lt;div&gt;Question not found.&lt;/div&gt;&#10;                    )}&#10;                  &lt;/CardContent&gt;&#10;                &lt;/Card&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;          )&#10;        })()}&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  )&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/dashboard/survey/page.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/dashboard/survey/page.tsx" />
              <option name="originalContent" value="&quot;use client&quot;&#10;&#10;import { SurveyForm } from &quot;@/components/survey/SurveyForm&quot;&#10;import { SurveyScenarioTable } from &quot;@/components/survey/SurveyScenarioTable&quot;&#10;import { SurveySimulator } from &quot;@/components/survey/SurveySimulator&quot;&#10;import { useState } from &quot;react&quot;&#10;import { Card, CardContent, CardHeader, CardTitle, CardDescription } from &quot;@/components/ui/card&quot;&#10;import { Button } from &quot;@/components/ui/button&quot;&#10;import { useToast } from &quot;@/hooks/use-toast&quot;&#10;&#10;interface ScenarioData {&#10;  id: string&#10;  minAge: number&#10;  maxAge: number&#10;  percentage: number&#10;  status: &quot;draft&quot; | &quot;sent&quot;&#10;  location?: string&#10;  gender?: string | null&#10;  questions: Array&lt;{&#10;    id: string&#10;    question: string&#10;  }&gt;&#10;  simulatedSurvey?: any&#10;}&#10;&#10;export default function SurveyPage() {&#10;  const [selectedScenarioId, setSelectedScenarioId] = useState&lt;string | null&gt;(null)&#10;  const [selectedScenario, setSelectedScenario] = useState&lt;ScenarioData | null&gt;(null)&#10;  const [refreshKey, setRefreshKey] = useState(0)&#10;  const [questionsLoaded, setQuestionsLoaded] = useState(false)&#10;  const [loadingQuestions, setLoadingQuestions] = useState(false)&#10;  const { toast } = useToast()&#10;&#10;  const handleViewResult = (scenarioId: string, scenario: ScenarioData) =&gt; {&#10;    setSelectedScenarioId(scenarioId)&#10;    setSelectedScenario(scenario)&#10;  }&#10;&#10;  const handleScenarioDeleted = (deletedScenarioId: string) =&gt; {&#10;    // Nếu scenario đang được xem bị xóa, reset về trạng thái ban đầu&#10;    if (selectedScenarioId === deletedScenarioId) {&#10;      setSelectedScenarioId(null)&#10;      setSelectedScenario(null)&#10;    }&#10;  }&#10;&#10;  const handleScenarioCreated = () =&gt; {&#10;    setRefreshKey(prev =&gt; prev + 1)&#10;  }&#10;&#10;  return (&#10;    &lt;div className=&quot;min-h-screen bg-gray-50/30 p-8&quot;&gt;&#10;      &lt;div className=&quot;mx-auto max-w-7xl space-y-8&quot;&gt;&#10;        &lt;div className=&quot;space-y-2&quot;&gt;&#10;          &lt;h1 className=&quot;text-3xl font-bold tracking-tight&quot;&gt;Survey Manager&lt;/h1&gt;&#10;          &lt;p className=&quot;text-base text-muted-foreground&quot;&gt;&#10;            Create demographic scenarios and simulate survey distribution&#10;          &lt;/p&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;Card&gt;&#10;          &lt;CardHeader&gt;&#10;            &lt;CardTitle&gt;Survey Questions&lt;/CardTitle&gt;&#10;            &lt;CardDescription&gt;Load questions from the server&lt;/CardDescription&gt;&#10;          &lt;/CardHeader&gt;&#10;          &lt;CardContent&gt;&#10;            {!questionsLoaded ? (&#10;              &lt;div className=&quot;flex flex-col items-start gap-3&quot;&gt;&#10;                &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;No questions loaded yet. Click &quot;Get Questions&quot; to load from server.&lt;/div&gt;&#10;                &lt;div&gt;&#10;                  &lt;Button onClick={async () =&gt; {&#10;                    try {&#10;                      setLoadingQuestions(true)&#10;                      // TODO: replace with real API call&#10;                      // await fetch('/api/questions')&#10;                      setQuestionsLoaded(true)&#10;                      toast({ title: 'Loaded', description: 'Questions loaded from server' })&#10;                    } catch (e) {&#10;                      toast({ title: 'Error', description: 'Failed to load questions', variant: 'destructive' })&#10;                    } finally {&#10;                      setLoadingQuestions(false)&#10;                    }&#10;                  }} disabled={loadingQuestions}&gt;&#10;                    {loadingQuestions ? 'Loading...' : 'Get Questions'}&#10;                  &lt;/Button&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            ) : (&#10;              &lt;div className=&quot;text-sm&quot;&gt;Questions loaded. (Replace with questions list UI)&lt;/div&gt;&#10;            )}&#10;          &lt;/CardContent&gt;&#10;        &lt;/Card&gt;&#10;        &lt;SurveyForm onScenarioCreated={handleScenarioCreated} /&gt;&#10;        &lt;SurveyScenarioTable&#10;          key={refreshKey}&#10;          onViewResult={handleViewResult}&#10;          onScenarioDeleted={handleScenarioDeleted}&#10;        /&gt;&#10;        &lt;SurveySimulator selectedScenarioId={selectedScenarioId} selectedScenario={selectedScenario} /&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  )&#10;}" />
              <option name="updatedContent" value="&quot;use client&quot;&#10;&#10;import { SurveyForm } from &quot;@/components/survey/SurveyForm&quot;&#10;import { SurveyScenarioTable } from &quot;@/components/survey/SurveyScenarioTable&quot;&#10;import { SurveySimulator } from &quot;@/components/survey/SurveySimulator&quot;&#10;import { useState } from &quot;react&quot;&#10;&#10;interface ScenarioData {&#10;  id: string&#10;  minAge: number&#10;  maxAge: number&#10;  percentage: number&#10;  status: &quot;draft&quot; | &quot;sent&quot;&#10;  location?: string&#10;  gender?: string | null&#10;  questions: Array&lt;{&#10;    id: string&#10;    question: string&#10;  }&gt;&#10;  simulatedSurvey?: any&#10;}&#10;&#10;export default function SurveyPage() {&#10;  const [selectedScenarioId, setSelectedScenarioId] = useState&lt;string | null&gt;(null)&#10;  const [selectedScenario, setSelectedScenario] = useState&lt;ScenarioData | null&gt;(null)&#10;  const [refreshKey, setRefreshKey] = useState(0)&#10;&#10;  const handleViewResult = (scenarioId: string, scenario: ScenarioData) =&gt; {&#10;    setSelectedScenarioId(scenarioId)&#10;    setSelectedScenario(scenario)&#10;  }&#10;&#10;  const handleScenarioDeleted = (deletedScenarioId: string) =&gt; {&#10;    // Nếu scenario đang được xem bị xóa, reset về trạng thái ban đầu&#10;    if (selectedScenarioId === deletedScenarioId) {&#10;      setSelectedScenarioId(null)&#10;      setSelectedScenario(null)&#10;    }&#10;  }&#10;&#10;  const handleScenarioCreated = () =&gt; {&#10;    setRefreshKey(prev =&gt; prev + 1)&#10;  }&#10;&#10;  return (&#10;    &lt;div className=&quot;min-h-screen bg-gray-50/30 p-8&quot;&gt;&#10;      &lt;div className=&quot;mx-auto max-w-7xl space-y-8&quot;&gt;&#10;        &lt;div className=&quot;space-y-2&quot;&gt;&#10;          &lt;h1 className=&quot;text-3xl font-bold tracking-tight&quot;&gt;Survey Manager&lt;/h1&gt;&#10;          &lt;p className=&quot;text-base text-muted-foreground&quot;&gt;&#10;            Create demographic scenarios and simulate survey distribution&#10;          &lt;/p&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;SurveyForm onScenarioCreated={handleScenarioCreated} /&gt;&#10;        &lt;SurveyScenarioTable&#10;          key={refreshKey}&#10;          onViewResult={handleViewResult}&#10;          onScenarioDeleted={handleScenarioDeleted}&#10;        /&gt;&#10;        &lt;SurveySimulator selectedScenarioId={selectedScenarioId} selectedScenario={selectedScenario} /&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  )&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>