<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/dashboard/questions-manage/page.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/dashboard/questions-manage/page.tsx" />
              <option name="originalContent" value="&quot;use client&quot;&#10;&#10;import React, { useState } from &quot;react&quot;&#10;import { Card, CardContent, CardHeader, CardTitle, CardDescription } from &quot;@/components/ui/card&quot;&#10;import { Button } from &quot;@/components/ui/button&quot;&#10;import { Checkbox } from &quot;@/components/ui/checkbox&quot;&#10;import { Input } from &quot;@/components/ui/input&quot;&#10;import { Textarea } from &quot;@/components/ui/textarea&quot;&#10;import { Badge } from &quot;@/components/ui/badge&quot;&#10;import { useToast } from &quot;@/hooks/use-toast&quot;&#10;import { Edit, Trash2, MoreHorizontal } from &quot;lucide-react&quot;&#10;import {&#10;  DropdownMenu,&#10;  DropdownMenuTrigger,&#10;  DropdownMenuContent,&#10;  DropdownMenuItem,&#10;  DropdownMenuLabel,&#10;  DropdownMenuSeparator,&#10;} from &quot;@/components/ui/dropdown-menu&quot;&#10;&#10;interface Question {&#10;  id: string&#10;  name: string&#10;  intent: string&#10;  filled_prompt: string&#10;  question_type: string&#10;}&#10;&#10;const MOCK_DB_QUESTIONS: Question[] = [&#10;  {&#10;    id: &quot;a3f1d6b2-1c2b-4d3a-8f1a-111111111111&quot;,&#10;    name: &quot;Bạn thường dùng sản phẩm bao lâu 1 lần?&quot;,&#10;    intent: &quot;frequency&quot;,&#10;    filled_prompt: &quot;Trong tháng qua, bạn đã sử dụng sản phẩm X bao nhiêu lần?&quot;,&#10;    question_type: &quot;scale&quot;,&#10;  },&#10;  {&#10;    id: &quot;b4f2d7c3-2d3c-5e4b-9f2b-222222222222&quot;,&#10;    name: &quot;Bạn có hài lòng với dịch vụ?&quot;,&#10;    intent: &quot;yesno&quot;,&#10;    filled_prompt: &quot;Bạn có hài lòng với dịch vụ của chúng tôi không?&quot;,&#10;    question_type: &quot;binary&quot;,&#10;  },&#10;  {&#10;    id: &quot;c5f3e8d4-3e4d-6f5c-af3c-333333333333&quot;,&#10;    name: &quot;Đánh giá trải nghiệm tổng thể&quot;,&#10;    intent: &quot;rating&quot;,&#10;    filled_prompt: &quot;Xin vui lòng đánh giá trải nghiệm tổng thể của bạn với sản phẩm (1-5)&quot;,&#10;    question_type: &quot;rating&quot;,&#10;  },&#10;]&#10;&#10;const MOCK_EXPERT_QUESTIONS: Question[] = [&#10;  {&#10;    id: &quot;d6f4a9e5-4f5e-7g6d-bf4d-444444444444&quot;,&#10;    name: &quot;Bạn chọn tính năng nào nhiều nhất?&quot;,&#10;    intent: &quot;choice&quot;,&#10;    filled_prompt: &quot;Trong các tính năng A, B, C, bạn thường dùng tính năng nào nhất?&quot;,&#10;    question_type: &quot;single_choice&quot;,&#10;  },&#10;  {&#10;    id: &quot;e7f5b0f6-5g6f-8h7e-cg5e-555555555555&quot;,&#10;    name: &quot;Tần suất tiếp cận thông tin&quot;,&#10;    intent: &quot;frequency&quot;,&#10;    filled_prompt: &quot;Bạn tiếp cận thông tin về sản phẩm qua kênh nào thường xuyên nhất?&quot;,&#10;    question_type: &quot;multiple_choice&quot;,&#10;  },&#10;]&#10;&#10;export default function ManageQuestionsPage() {&#10;  const [dbSelected, setDbSelected] = useState&lt;Record&lt;string, boolean&gt;&gt;({})&#10;  const [expertSelected, setExpertSelected] = useState&lt;Record&lt;string, boolean&gt;&gt;({})&#10;  const [name, setName] = useState(&quot;&quot;)&#10;  const [description, setDescription] = useState(&quot;&quot;)&#10;  // UI polish: search and filter for enterprise UX&#10;  const [searchQuery, setSearchQuery] = useState(&quot;&quot;)&#10;  const [intentFilter, setIntentFilter] = useState(&quot;&quot;)&#10;  const { toast } = useToast()&#10;&#10;  // Ratings state for rating-type questions (1-5)&#10;  const [ratings, setRatings] = useState&lt;Record&lt;string, number | &quot;&quot;&gt;&gt;({})&#10;&#10;  const handleRatingChange = (id: string, value: string) =&gt; {&#10;    setRatings(prev =&gt; ({ ...prev, [id]: value === &quot;&quot; ? &quot;&quot; : Number(value) }))&#10;  }&#10;&#10;  // New state: questions-manage expert questions list so we can edit/delete/reorder&#10;  const [expertQuestions, setExpertQuestions] = useState&lt;Question[]&gt;(MOCK_EXPERT_QUESTIONS)&#10;  const [editingId, setEditingId] = useState&lt;string | null&gt;(null)&#10;  const [editingData, setEditingData] = useState&lt;Partial&lt;Question&gt;&gt;({})&#10;&#10;  // New state: saved question sets created from selections&#10;  const [questionSets, setQuestionSets] = useState&lt;{&#10;    id: string&#10;    name: string&#10;    description: string&#10;    questionIds: string[]&#10;  }[]&gt;([])&#10;&#10;  const toggleDb = (id: string, value: boolean) =&gt; {&#10;    setDbSelected(prev =&gt; ({ ...prev, [id]: value }))&#10;  }&#10;&#10;  const toggleExpert = (id: string, value: boolean) =&gt; {&#10;    setExpertSelected(prev =&gt; ({ ...prev, [id]: value }))&#10;  }&#10;&#10;  const createQuestionSet = () =&gt; {&#10;    const selectedDbIds = Object.entries(dbSelected).filter(([_, v]) =&gt; v).map(([k]) =&gt; k)&#10;    const selectedExpertIds = Object.entries(expertSelected).filter(([_, v]) =&gt; v).map(([k]) =&gt; k)&#10;    const questionIds = [...selectedDbIds, ...selectedExpertIds]&#10;&#10;    if (name.trim() === &quot;&quot;) {&#10;      toast({ title: &quot;Error&quot;, description: &quot;Please enter a name for the question set&quot;, variant: &quot;destructive&quot; })&#10;      return&#10;    }&#10;&#10;    if (questionIds.length === 0) {&#10;      toast({ title: &quot;Error&quot;, description: &quot;Please select at least one question&quot;, variant: &quot;destructive&quot; })&#10;      return&#10;    }&#10;&#10;    const newSet = {&#10;      id: `${Date.now()}`,&#10;      name: name.trim(),&#10;      description: description.trim(),&#10;      questionIds,&#10;    }&#10;&#10;    // Save the set locally (replace with API call if needed)&#10;    setQuestionSets(prev =&gt; [newSet, ...prev])&#10;&#10;    toast({ title: &quot;Success&quot;, description: `Question set &quot;${newSet.name}&quot; created (${questionIds.length} questions)` })&#10;&#10;    // Reset form and only unselect the questions that were used in the created set&#10;    setName(&quot;&quot;)&#10;    setDescription(&quot;&quot;)&#10;&#10;    setDbSelected(prev =&gt; {&#10;      const copy = { ...prev }&#10;      selectedDbIds.forEach(id =&gt; {&#10;        if (id in copy) delete copy[id]&#10;      })&#10;      return copy&#10;    })&#10;&#10;    setExpertSelected(prev =&gt; {&#10;      const copy = { ...prev }&#10;      selectedExpertIds.forEach(id =&gt; {&#10;        if (id in copy) delete copy[id]&#10;      })&#10;      return copy&#10;    })&#10;  }&#10;&#10;  // delete saved question set&#10;  const deleteQuestionSet = (id: string) =&gt; {&#10;    if (!window.confirm(&quot;Delete this question set?&quot;)) return&#10;    setQuestionSets(prev =&gt; prev.filter(s =&gt; s.id !== id))&#10;    toast({ title: &quot;Deleted&quot;, description: &quot;Question set removed&quot; })&#10;  }&#10;&#10;  // Expert question actions&#10;  const deleteExpertQuestion = (id: string) =&gt; {&#10;    if (!window.confirm(&quot;Are you sure you want to delete this question?&quot;)) return&#10;    setExpertQuestions(prev =&gt; prev.filter(q =&gt; q.id !== id))&#10;    setExpertSelected(prev =&gt; {&#10;      const copy = { ...prev }&#10;      delete copy[id]&#10;      return copy&#10;    })&#10;    toast({ title: &quot;Deleted&quot;, description: &quot;Expert question has been deleted&quot; })&#10;  }&#10;&#10;  const startEdit = (q: Question) =&gt; {&#10;    setEditingId(q.id)&#10;    setEditingData({ ...q })&#10;  }&#10;&#10;  const cancelEdit = () =&gt; {&#10;    setEditingId(null)&#10;    setEditingData({})&#10;  }&#10;&#10;  const saveEdit = () =&gt; {&#10;    if (!editingId) return&#10;    setExpertQuestions(prev =&gt; prev.map(q =&gt; (q.id === editingId ? { ...(q as Question), ...(editingData as Question) } : q)))&#10;    setEditingId(null)&#10;    setEditingData({})&#10;    toast({ title: &quot;Saved&quot;, description: &quot;Expert question has been updated&quot; })&#10;  }&#10;&#10;  // Compute selected question objects for preview&#10;  const selectedDbQuestions = MOCK_DB_QUESTIONS.filter(q =&gt; dbSelected[q.id])&#10;  const selectedExpertQuestions = expertQuestions.filter(q =&gt; expertSelected[q.id])&#10;  const selectedQuestions = [...selectedDbQuestions, ...selectedExpertQuestions]&#10;&#10;  // helper to get question name by id&#10;  const getQuestionById = (id: string) =&gt; {&#10;    return MOCK_DB_QUESTIONS.concat(expertQuestions).find(q =&gt; q.id === id)&#10;  }&#10;&#10;  // helper: map intent to badge color classes&#10;  const intentColor = (intent?: string) =&gt; {&#10;    switch (intent) {&#10;      case &quot;frequency&quot;:&#10;        return &quot;bg-blue-100 text-blue-800&quot;&#10;      case &quot;yesno&quot;:&#10;        return &quot;bg-green-100 text-green-800&quot;&#10;      case &quot;rating&quot;:&#10;        return &quot;bg-yellow-100 text-yellow-800&quot;&#10;      case &quot;choice&quot;:&#10;        return &quot;bg-indigo-100 text-indigo-800&quot;&#10;      case &quot;binary&quot;:&#10;        return &quot;bg-rose-100 text-rose-800&quot;&#10;      default:&#10;        return &quot;bg-gray-200 text-gray-800&quot;&#10;    }&#10;  }&#10;&#10;  // compute intents for filter select&#10;  const allIntents = Array.from(new Set(MOCK_DB_QUESTIONS.concat(MOCK_EXPERT_QUESTIONS).map(q =&gt; q.intent))).filter(Boolean)&#10;&#10;  // filtered lists based on search and intent filter&#10;  const filteredDbQuestions = MOCK_DB_QUESTIONS.filter(q =&gt; {&#10;    const matchQuery = searchQuery.trim() === &quot;&quot; || (q.name + &quot; &quot; + q.filled_prompt).toLowerCase().includes(searchQuery.toLowerCase())&#10;    const matchIntent = intentFilter === &quot;&quot; || q.intent === intentFilter&#10;    return matchQuery &amp;&amp; matchIntent&#10;  })&#10;&#10;  const filteredExpertQuestions = expertQuestions.filter(q =&gt; {&#10;    const matchQuery = searchQuery.trim() === &quot;&quot; || (q.name + &quot; &quot; + q.filled_prompt).toLowerCase().includes(searchQuery.toLowerCase())&#10;    const matchIntent = intentFilter === &quot;&quot; || q.intent === intentFilter&#10;    return matchQuery &amp;&amp; matchIntent&#10;  })&#10;&#10;  return (&#10;    &lt;div className=&quot;min-h-screen p-8 bg-gradient-to-br from-gray-50 to-gray-100/50&quot;&gt;&#10;      &lt;div className=&quot;mx-auto max-w-7xl space-y-6&quot;&gt;&#10;        &lt;div className=&quot;space-y-3&quot;&gt;&#10;          &lt;div className=&quot;flex items-center justify-between gap-4&quot;&gt;&#10;            &lt;div&gt;&#10;              &lt;h1 className=&quot;text-3xl font-bold&quot;&gt;Question Management&lt;/h1&gt;&#10;              &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Select questions from Database and Expert to create a new question set&lt;/p&gt;&#10;            &lt;/div&gt;&#10;            &lt;div className=&quot;hidden md:flex items-center gap-2&quot;&gt;&#10;              &lt;Input placeholder=&quot;Search questions...&quot; value={searchQuery} onChange={(e) =&gt; setSearchQuery(e.target.value)} className=&quot;w-[320px]&quot; /&gt;&#10;              &lt;select value={intentFilter} onChange={(e) =&gt; setIntentFilter(e.target.value)} className=&quot;text-sm border rounded px-2 py-1&quot;&gt;&#10;                &lt;option value=&quot;&quot;&gt;All intents&lt;/option&gt;&#10;                {allIntents.map(i =&gt; (&lt;option key={i} value={i}&gt;{i}&lt;/option&gt;))}&#10;              &lt;/select&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;          {/* mobile search */}&#10;          &lt;div className=&quot;md:hidden&quot;&gt;&#10;            &lt;Input placeholder=&quot;Search questions...&quot; value={searchQuery} onChange={(e) =&gt; setSearchQuery(e.target.value)} /&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div className=&quot;grid gap-6 lg:grid-cols-2&quot;&gt;&#10;          &lt;Card className=&quot;shadow-lg rounded-xl overflow-hidden&quot;&gt;&#10;            &lt;CardHeader&gt;&#10;              &lt;CardTitle&gt;Database Questions&lt;/CardTitle&gt;&#10;              &lt;CardDescription&gt;Mock list of all questions from the database&lt;/CardDescription&gt;&#10;            &lt;/CardHeader&gt;&#10;            &lt;CardContent className=&quot;p-4&quot;&gt;&#10;              &lt;div className=&quot;space-y-3 max-h-[520px] overflow-y-auto&quot;&gt;&#10;                {filteredDbQuestions.map((q) =&gt; (&#10;                  &lt;div key={q.id} className=&quot;flex items-start gap-3 p-3 rounded-lg bg-white hover:shadow-md transition transform hover:-translate-y-0.5&quot;&gt;&#10;                    &lt;Checkbox id={`db-${q.id}`} checked={dbSelected[q.id]} onCheckedChange={(v) =&gt; toggleDb(q.id, v as boolean)} /&gt;&#10;                    &lt;div className=&quot;flex-1&quot;&gt;&#10;                      &lt;div className=&quot;flex items-center gap-3 mb-1 justify-between&quot;&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;Badge className={`text-xs ${intentColor(q.intent)}`}&gt;{q.intent}&lt;/Badge&gt;&#10;                          &lt;div className=&quot;font-medium&quot;&gt;{q.name}&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div className=&quot;text-sm text-muted-foreground italic&quot;&gt;{q.filled_prompt}&lt;/div&gt;&#10;                      &lt;div className=&quot;text-xs text-muted-foreground mt-2&quot;&gt;ID: {q.id}&lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            &lt;/CardContent&gt;&#10;          &lt;/Card&gt;&#10;&#10;          &lt;Card className=&quot;shadow-lg rounded-xl overflow-hidden&quot;&gt;&#10;            &lt;CardHeader&gt;&#10;              &lt;CardTitle&gt;Expert Questions&lt;/CardTitle&gt;&#10;              &lt;CardDescription&gt;Questions generated by experts&lt;/CardDescription&gt;&#10;            &lt;/CardHeader&gt;&#10;            &lt;CardContent className=&quot;p-4&quot;&gt;&#10;              &lt;div className=&quot;space-y-3 max-h-[520px] overflow-y-auto&quot;&gt;&#10;                {filteredExpertQuestions.map((q) =&gt; (&#10;                  &lt;div key={q.id} className=&quot;flex items-start gap-3 p-3 rounded-lg bg-white hover:shadow-md transition transform hover:-translate-y-0.5&quot;&gt;&#10;                    &lt;Checkbox id={`exp-${q.id}`} checked={expertSelected[q.id]} onCheckedChange={(v) =&gt; toggleExpert(q.id, v as boolean)} /&gt;&#10;&#10;                    &lt;div className=&quot;flex-1&quot;&gt;&#10;                      &lt;div className=&quot;flex items-center gap-2 mb-1 justify-between&quot;&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;Badge className={`text-xs ${intentColor(q.intent)}`}&gt;{q.intent}&lt;/Badge&gt;&#10;                          &lt;div className=&quot;font-medium&quot;&gt;{q.name}&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;DropdownMenu&gt;&#10;                            &lt;DropdownMenuTrigger asChild&gt;&#10;                              &lt;Button variant=&quot;ghost&quot; size=&quot;sm&quot; title=&quot;Actions&quot; className=&quot;w-8 h-8 rounded-full&quot;&gt;&#10;                                &lt;MoreHorizontal className=&quot;w-4 h-4&quot; /&gt;&#10;                              &lt;/Button&gt;&#10;                            &lt;/DropdownMenuTrigger&gt;&#10;                            &lt;DropdownMenuContent align=&quot;end&quot; className=&quot;w-52&quot;&gt;&#10;                              &lt;DropdownMenuLabel&gt;Actions&lt;/DropdownMenuLabel&gt;&#10;                              &lt;DropdownMenuSeparator /&gt;&#10;&#10;                              &lt;div className=&quot;px-2 py-2&quot;&gt;&#10;                                &lt;label className=&quot;text-xs text-muted-foreground&quot;&gt;Rating&lt;/label&gt;&#10;                                &lt;select&#10;                                  value={ratings[q.id] ?? &quot;&quot;}&#10;                                  onChange={(e) =&gt; handleRatingChange(q.id, e.target.value)}&#10;                                  className=&quot;mt-1 w-full text-sm border rounded px-2 py-1&quot;&#10;                                &gt;&#10;                                  &lt;option value=&quot;&quot;&gt;Select&lt;/option&gt;&#10;                                  &lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;&#10;                                  &lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;&#10;                                  &lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;&#10;                                  &lt;option value=&quot;4&quot;&gt;4&lt;/option&gt;&#10;                                  &lt;option value=&quot;5&quot;&gt;5&lt;/option&gt;&#10;                                &lt;/select&gt;&#10;                              &lt;/div&gt;&#10;&#10;                              &lt;DropdownMenuSeparator /&gt;&#10;                              &lt;DropdownMenuItem onClick={() =&gt; startEdit(q)}&gt;&#10;                                &lt;Edit className=&quot;mr-2 h-4 w-4&quot; /&gt;&#10;                                Edit&#10;                              &lt;/DropdownMenuItem&gt;&#10;                              &lt;DropdownMenuItem onClick={() =&gt; deleteExpertQuestion(q.id)} variant=&quot;destructive&quot;&gt;&#10;                                &lt;Trash2 className=&quot;mr-2 h-4 w-4&quot; /&gt;&#10;                                Delete&#10;                              &lt;/DropdownMenuItem&gt;&#10;                            &lt;/DropdownMenuContent&gt;&#10;                          &lt;/DropdownMenu&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;&#10;                      {editingId === q.id ? (&#10;                        &lt;div className=&quot;space-y-2&quot;&gt;&#10;                          &lt;Input value={editingData.name || &quot;&quot;} onChange={(e) =&gt; setEditingData(prev =&gt; ({ ...prev, name: e.target.value }))} /&gt;&#10;                          &lt;Textarea value={editingData.filled_prompt || &quot;&quot;} onChange={(e) =&gt; setEditingData(prev =&gt; ({ ...prev, filled_prompt: e.target.value }))} /&gt;&#10;                          &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                            &lt;Input value={editingData.intent || &quot;&quot;} onChange={(e) =&gt; setEditingData(prev =&gt; ({ ...prev, intent: e.target.value }))} placeholder=&quot;intent&quot; /&gt;&#10;                            &lt;Input value={editingData.question_type || &quot;&quot;} onChange={(e) =&gt; setEditingData(prev =&gt; ({ ...prev, question_type: e.target.value }))} placeholder=&quot;type&quot; /&gt;&#10;                          &lt;/div&gt;&#10;                          &lt;div className=&quot;flex gap-2 pt-2&quot;&gt;&#10;                            &lt;Button size=&quot;sm&quot; onClick={saveEdit} className=&quot;bg-green-600&quot;&gt;Save&lt;/Button&gt;&#10;                            &lt;Button size=&quot;sm&quot; onClick={cancelEdit} variant=&quot;outline&quot;&gt;Cancel&lt;/Button&gt;&#10;                          &lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                      ) : (&#10;                        &lt;&gt;&#10;                          &lt;div className=&quot;text-sm text-muted-foreground italic&quot;&gt;{q.filled_prompt}&lt;/div&gt;&#10;                          &lt;div className=&quot;text-xs text-muted-foreground mt-2&quot;&gt;ID: {q.id}&lt;/div&gt;&#10;                        &lt;/&gt;&#10;                      )}&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            &lt;/CardContent&gt;&#10;          &lt;/Card&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;Card&gt;&#10;          &lt;CardHeader&gt;&#10;            &lt;CardTitle&gt;Create New Question Set&lt;/CardTitle&gt;&#10;            &lt;CardDescription&gt;Enter name, description and create a question set from selected questions&lt;/CardDescription&gt;&#10;          &lt;/CardHeader&gt;&#10;          &lt;CardContent className=&quot;p-4 space-y-4&quot;&gt;&#10;            &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4&quot;&gt;&#10;              &lt;Input placeholder=&quot;Question set name&quot; value={name} onChange={(e) =&gt; setName(e.target.value)} /&gt;&#10;              &lt;Textarea placeholder=&quot;Description (optional)&quot; value={description} onChange={(e) =&gt; setDescription(e.target.value)} /&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div className=&quot;flex items-center justify-between&quot;&gt;&#10;              &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;Selected total: {(Object.values(dbSelected).filter(Boolean).length) + (Object.values(expertSelected).filter(Boolean).length)} questions&lt;/div&gt;&#10;              &lt;Button onClick={createQuestionSet} className=&quot;bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700&quot;&gt;Create Question Set&lt;/Button&gt;&#10;            &lt;/div&gt;&#10;          &lt;/CardContent&gt;&#10;        &lt;/Card&gt;&#10;&#10;        &lt;Card className=&quot;shadow-md rounded-lg&quot;&gt;&#10;          &lt;CardHeader&gt;&#10;            &lt;CardTitle&gt;Selected Questions&lt;/CardTitle&gt;&#10;            &lt;CardDescription&gt;Preview of selected questions for the new set&lt;/CardDescription&gt;&#10;          &lt;/CardHeader&gt;&#10;          &lt;CardContent className=&quot;p-4&quot;&gt;&#10;            {selectedQuestions.length === 0 ? (&#10;              &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;No questions selected yet&lt;/div&gt;&#10;            ) : (&#10;              &lt;div&gt;&#10;                &lt;div className=&quot;flex items-center justify-between mb-4&quot;&gt;&#10;                  &lt;div&gt;&#10;                    &lt;div className=&quot;text-sm font-medium&quot;&gt;Question Set: {name || &quot;&lt;name&gt;&quot;}&lt;/div&gt;&#10;                    &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;{description}&lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;Total: &lt;span className=&quot;font-semibold text-700&quot;&gt;{selectedQuestions.length}&lt;/span&gt;&lt;/div&gt;&#10;                &lt;/div&gt;&#10;&#10;                &lt;div className=&quot;grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4&quot;&gt;&#10;                  {selectedQuestions.map((q) =&gt; (&#10;                    &lt;div key={q.id} className=&quot;bg-white border rounded-lg p-3 shadow-sm hover:shadow-md transition&quot;&gt;&#10;                      &lt;div className=&quot;flex items-start justify-between gap-2&quot;&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;Badge className={`text-xs ${intentColor(q.intent)}`}&gt;{q.intent}&lt;/Badge&gt;&#10;                          &lt;div className=&quot;font-medium&quot;&gt;{q.name}&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;div className=&quot;text-right&quot;&gt;&#10;                          {ratings[q.id] ? (&#10;                            &lt;Badge className=&quot;bg-yellow-100 text-yellow-800&quot;&gt;{ratings[q.id]} ★&lt;/Badge&gt;&#10;                          ) : (&#10;                            &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;No rating&lt;/div&gt;&#10;                          )}&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;&#10;                      &lt;div className=&quot;mt-2 text-sm text-muted-foreground line-clamp-3&quot;&gt;{q.filled_prompt}&lt;/div&gt;&#10;                      &lt;div className=&quot;mt-3 flex items-center justify-between text-xs text-muted-foreground&quot;&gt;&#10;                        &lt;div&gt;ID: &lt;span className=&quot;font-mono text-[11px]&quot;&gt;{q.id.slice(0,8)}…&lt;/span&gt;&lt;/div&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;Type: &lt;span className=&quot;font-medium&quot;&gt;{q.question_type}&lt;/span&gt;&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            )}&#10;          &lt;/CardContent&gt;&#10;        &lt;/Card&gt;&#10;&#10;        {/* New: Saved Question Sets list (bottom box) */}&#10;        &lt;Card className=&quot;mt-4&quot;&gt;&#10;          &lt;CardHeader&gt;&#10;            &lt;CardTitle&gt;Saved Question Sets&lt;/CardTitle&gt;&#10;            &lt;CardDescription&gt;List of created question sets (preview)&lt;/CardDescription&gt;&#10;          &lt;/CardHeader&gt;&#10;          &lt;CardContent className=&quot;p-4&quot;&gt;&#10;            {questionSets.length === 0 ? (&#10;              &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;No saved question sets yet&lt;/div&gt;&#10;            ) : (&#10;              &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4&quot;&gt;&#10;                {questionSets.map((set) =&gt; (&#10;                  &lt;div key={set.id} className=&quot;bg-white border rounded-lg p-4 shadow-sm hover:shadow-md transition&quot;&gt;&#10;                    &lt;div className=&quot;flex items-start justify-between gap-4&quot;&gt;&#10;                      &lt;div&gt;&#10;                        &lt;div className=&quot;text-sm font-semibold&quot;&gt;{set.name}&lt;/div&gt;&#10;                        &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;{set.description || &lt;span className=&quot;italic text-muted-foreground&quot;&gt;No description&lt;/span&gt;}&lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div className=&quot;flex flex-col items-end gap-2&quot;&gt;&#10;                        &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;{set.questionIds.length} questions&lt;/div&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;Button size=&quot;sm&quot; variant=&quot;ghost&quot; onClick={() =&gt; navigator.clipboard.writeText(set.id)}&gt;Copy ID&lt;/Button&gt;&#10;                          &lt;Button size=&quot;sm&quot; variant=&quot;destructive&quot; onClick={() =&gt; deleteQuestionSet(set.id)}&gt;Delete&lt;/Button&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div className=&quot;mt-3 flex flex-wrap gap-2&quot;&gt;&#10;                      {set.questionIds.map((qid) =&gt; {&#10;                        const q = getQuestionById(qid)&#10;                        return (&#10;                          &lt;div key={qid} className=&quot;px-3 py-1 rounded-full bg-gray-100 text-sm flex items-center gap-2&quot;&gt;&#10;                            &lt;Badge className=&quot;bg-gray-200 text-xs&quot;&gt;{q?.intent ?? &quot;-&quot;}&lt;/Badge&gt;&#10;                            &lt;div className=&quot;truncate max-w-[160px]&quot;&gt;{q?.name ?? qid}&lt;/div&gt;&#10;                          &lt;/div&gt;&#10;                        )&#10;                      })}&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            )}&#10;          &lt;/CardContent&gt;&#10;        &lt;/Card&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  )&#10;}&#10;" />
              <option name="updatedContent" value="&quot;use client&quot;&#10;&#10;import React, { useState, useEffect } from &quot;react&quot;&#10;import { Card, CardContent, CardHeader, CardTitle, CardDescription } from &quot;@/components/ui/card&quot;&#10;import { Button } from &quot;@/components/ui/button&quot;&#10;import { Checkbox } from &quot;@/components/ui/checkbox&quot;&#10;import { Input } from &quot;@/components/ui/input&quot;&#10;import { Textarea } from &quot;@/components/ui/textarea&quot;&#10;import { Badge } from &quot;@/components/ui/badge&quot;&#10;import { useToast } from &quot;@/hooks/use-toast&quot;&#10;import { Edit, Trash2, MoreHorizontal } from &quot;lucide-react&quot;&#10;import {&#10;  DropdownMenu,&#10;  DropdownMenuTrigger,&#10;  DropdownMenuContent,&#10;  DropdownMenuItem,&#10;  DropdownMenuLabel,&#10;  DropdownMenuSeparator,&#10;} from &quot;@/components/ui/dropdown-menu&quot;&#10;&#10;interface Question {&#10;  id: string&#10;  name: string&#10;  intent: string&#10;  filled_prompt: string&#10;  question_type: string&#10;}&#10;&#10;const MOCK_DB_QUESTIONS: Question[] = [&#10;  {&#10;    id: &quot;a3f1d6b2-1c2b-4d3a-8f1a-111111111111&quot;,&#10;    name: &quot;Bạn thường dùng sản phẩm bao lâu 1 lần?&quot;,&#10;    intent: &quot;frequency&quot;,&#10;    filled_prompt: &quot;Trong tháng qua, bạn đã sử dụng sản phẩm X bao nhiêu lần?&quot;,&#10;    question_type: &quot;scale&quot;,&#10;  },&#10;  {&#10;    id: &quot;b4f2d7c3-2d3c-5e4b-9f2b-222222222222&quot;,&#10;    name: &quot;Bạn có hài lòng với dịch vụ?&quot;,&#10;    intent: &quot;yesno&quot;,&#10;    filled_prompt: &quot;Bạn có hài lòng với dịch vụ của chúng tôi không?&quot;,&#10;    question_type: &quot;binary&quot;,&#10;  },&#10;  {&#10;    id: &quot;c5f3e8d4-3e4d-6f5c-af3c-333333333333&quot;,&#10;    name: &quot;Đánh giá trải nghiệm tổng thể&quot;,&#10;    intent: &quot;rating&quot;,&#10;    filled_prompt: &quot;Xin vui lòng đánh giá trải nghiệm tổng thể của bạn với sản phẩm (1-5)&quot;,&#10;    question_type: &quot;rating&quot;,&#10;  },&#10;]&#10;&#10;const MOCK_EXPERT_QUESTIONS: Question[] = [&#10;  {&#10;    id: &quot;d6f4a9e5-4f5e-7g6d-bf4d-444444444444&quot;,&#10;    name: &quot;Bạn chọn tính năng nào nhiều nhất?&quot;,&#10;    intent: &quot;choice&quot;,&#10;    filled_prompt: &quot;Trong các tính năng A, B, C, bạn thường dùng tính năng nào nhất?&quot;,&#10;    question_type: &quot;single_choice&quot;,&#10;  },&#10;  {&#10;    id: &quot;e7f5b0f6-5g6f-8h7e-cg5e-555555555555&quot;,&#10;    name: &quot;Tần suất tiếp cận thông tin&quot;,&#10;    intent: &quot;frequency&quot;,&#10;    filled_prompt: &quot;Bạn tiếp cận thông tin về sản phẩm qua kênh nào thường xuyên nhất?&quot;,&#10;    question_type: &quot;multiple_choice&quot;,&#10;  },&#10;]&#10;&#10;export default function ManageQuestionsPage() {&#10;  const [dbSelected, setDbSelected] = useState&lt;Record&lt;string, boolean&gt;&gt;({})&#10;  const [expertSelected, setExpertSelected] = useState&lt;Record&lt;string, boolean&gt;&gt;({})&#10;  const [name, setName] = useState(&quot;&quot;)&#10;  const [description, setDescription] = useState(&quot;&quot;)&#10;  // UI polish: search and filter for enterprise UX&#10;  const [searchQuery, setSearchQuery] = useState(&quot;&quot;)&#10;  const [intentFilter, setIntentFilter] = useState(&quot;&quot;)&#10;  const { toast } = useToast()&#10;&#10;  // Ratings state for rating-type questions (1-5)&#10;  const [ratings, setRatings] = useState&lt;Record&lt;string, number | &quot;&quot;&gt;&gt;({})&#10;&#10;  const handleRatingChange = (id: string, value: string) =&gt; {&#10;    setRatings(prev =&gt; ({ ...prev, [id]: value === &quot;&quot; ? &quot;&quot; : Number(value) }))&#10;  }&#10;&#10;  // New state: questions-manage expert questions list so we can edit/delete/reorder&#10;  const [expertQuestions, setExpertQuestions] = useState&lt;Question[]&gt;(MOCK_EXPERT_QUESTIONS)&#10;  const [editingId, setEditingId] = useState&lt;string | null&gt;(null)&#10;  const [editingData, setEditingData] = useState&lt;Partial&lt;Question&gt;&gt;({})&#10;&#10;  // New state: saved question sets created from selections&#10;  const [questionSets, setQuestionSets] = useState&lt;{&#10;    id: string&#10;    name: string&#10;    description: string&#10;    questionIds: string[]&#10;  }[]&gt;([])&#10;&#10;  // Load saved question sets from localStorage on mount&#10;  useEffect(() =&gt; {&#10;    try {&#10;      const raw = localStorage.getItem(&quot;questionSets&quot;)&#10;      if (raw) {&#10;        const parsed = JSON.parse(raw)&#10;        if (Array.isArray(parsed)) setQuestionSets(parsed)&#10;      }&#10;    } catch (e) {&#10;      console.warn(&quot;Failed to load saved question sets from localStorage&quot;, e)&#10;    }&#10;  }, [])&#10;&#10;  // Persist questionSets to localStorage whenever it changes&#10;  useEffect(() =&gt; {&#10;    try {&#10;      localStorage.setItem(&quot;questionSets&quot;, JSON.stringify(questionSets))&#10;    } catch (e) {&#10;      console.warn(&quot;Failed to save question sets to localStorage&quot;, e)&#10;    }&#10;  }, [questionSets])&#10;&#10;  const toggleDb = (id: string, value: boolean) =&gt; {&#10;    setDbSelected(prev =&gt; ({ ...prev, [id]: value }))&#10;  }&#10;&#10;  const toggleExpert = (id: string, value: boolean) =&gt; {&#10;    setExpertSelected(prev =&gt; ({ ...prev, [id]: value }))&#10;  }&#10;&#10;  const createQuestionSet = () =&gt; {&#10;    const selectedDbIds = Object.entries(dbSelected).filter(([_, v]) =&gt; v).map(([k]) =&gt; k)&#10;    const selectedExpertIds = Object.entries(expertSelected).filter(([_, v]) =&gt; v).map(([k]) =&gt; k)&#10;    const questionIds = [...selectedDbIds, ...selectedExpertIds]&#10;&#10;    if (name.trim() === &quot;&quot;) {&#10;      toast({ title: &quot;Error&quot;, description: &quot;Please enter a name for the question set&quot;, variant: &quot;destructive&quot; })&#10;      return&#10;    }&#10;&#10;    if (questionIds.length === 0) {&#10;      toast({ title: &quot;Error&quot;, description: &quot;Please select at least one question&quot;, variant: &quot;destructive&quot; })&#10;      return&#10;    }&#10;&#10;    const newSet = {&#10;      id: `${Date.now()}`,&#10;      name: name.trim(),&#10;      description: description.trim(),&#10;      questionIds,&#10;    }&#10;&#10;    // Save the set locally (replace with API call if needed)&#10;    setQuestionSets(prev =&gt; [newSet, ...prev])&#10;&#10;    toast({ title: &quot;Success&quot;, description: `Question set &quot;${newSet.name}&quot; created (${questionIds.length} questions)` })&#10;&#10;    // Reset form and only unselect the questions that were used in the created set&#10;    setName(&quot;&quot;)&#10;    setDescription(&quot;&quot;)&#10;&#10;    setDbSelected(prev =&gt; {&#10;      const copy = { ...prev }&#10;      selectedDbIds.forEach(id =&gt; {&#10;        if (id in copy) delete copy[id]&#10;      })&#10;      return copy&#10;    })&#10;&#10;    setExpertSelected(prev =&gt; {&#10;      const copy = { ...prev }&#10;      selectedExpertIds.forEach(id =&gt; {&#10;        if (id in copy) delete copy[id]&#10;      })&#10;      return copy&#10;    })&#10;  }&#10;&#10;  // delete saved question set&#10;  const deleteQuestionSet = (id: string) =&gt; {&#10;    if (!window.confirm(&quot;Delete this question set?&quot;)) return&#10;    setQuestionSets(prev =&gt; prev.filter(s =&gt; s.id !== id))&#10;    toast({ title: &quot;Deleted&quot;, description: &quot;Question set removed&quot; })&#10;  }&#10;&#10;  // Expert question actions&#10;  const deleteExpertQuestion = (id: string) =&gt; {&#10;    if (!window.confirm(&quot;Are you sure you want to delete this question?&quot;)) return&#10;    setExpertQuestions(prev =&gt; prev.filter(q =&gt; q.id !== id))&#10;    setExpertSelected(prev =&gt; {&#10;      const copy = { ...prev }&#10;      delete copy[id]&#10;      return copy&#10;    })&#10;    toast({ title: &quot;Deleted&quot;, description: &quot;Expert question has been deleted&quot; })&#10;  }&#10;&#10;  const startEdit = (q: Question) =&gt; {&#10;    setEditingId(q.id)&#10;    setEditingData({ ...q })&#10;  }&#10;&#10;  const cancelEdit = () =&gt; {&#10;    setEditingId(null)&#10;    setEditingData({})&#10;  }&#10;&#10;  const saveEdit = () =&gt; {&#10;    if (!editingId) return&#10;    setExpertQuestions(prev =&gt; prev.map(q =&gt; (q.id === editingId ? { ...(q as Question), ...(editingData as Question) } : q)))&#10;    setEditingId(null)&#10;    setEditingData({})&#10;    toast({ title: &quot;Saved&quot;, description: &quot;Expert question has been updated&quot; })&#10;  }&#10;&#10;  // Compute selected question objects for preview&#10;  const selectedDbQuestions = MOCK_DB_QUESTIONS.filter(q =&gt; dbSelected[q.id])&#10;  const selectedExpertQuestions = expertQuestions.filter(q =&gt; expertSelected[q.id])&#10;  const selectedQuestions = [...selectedDbQuestions, ...selectedExpertQuestions]&#10;&#10;  // helper to get question name by id&#10;  const getQuestionById = (id: string) =&gt; {&#10;    return MOCK_DB_QUESTIONS.concat(expertQuestions).find(q =&gt; q.id === id)&#10;  }&#10;&#10;  // helper: map intent to badge color classes&#10;  const intentColor = (intent?: string) =&gt; {&#10;    switch (intent) {&#10;      case &quot;frequency&quot;:&#10;        return &quot;bg-blue-100 text-blue-800&quot;&#10;      case &quot;yesno&quot;:&#10;        return &quot;bg-green-100 text-green-800&quot;&#10;      case &quot;rating&quot;:&#10;        return &quot;bg-yellow-100 text-yellow-800&quot;&#10;      case &quot;choice&quot;:&#10;        return &quot;bg-indigo-100 text-indigo-800&quot;&#10;      case &quot;binary&quot;:&#10;        return &quot;bg-rose-100 text-rose-800&quot;&#10;      default:&#10;        return &quot;bg-gray-200 text-gray-800&quot;&#10;    }&#10;  }&#10;&#10;  // compute intents for filter select&#10;  const allIntents = Array.from(new Set(MOCK_DB_QUESTIONS.concat(MOCK_EXPERT_QUESTIONS).map(q =&gt; q.intent))).filter(Boolean)&#10;&#10;  // filtered lists based on search and intent filter&#10;  const filteredDbQuestions = MOCK_DB_QUESTIONS.filter(q =&gt; {&#10;    const matchQuery = searchQuery.trim() === &quot;&quot; || (q.name + &quot; &quot; + q.filled_prompt).toLowerCase().includes(searchQuery.toLowerCase())&#10;    const matchIntent = intentFilter === &quot;&quot; || q.intent === intentFilter&#10;    return matchQuery &amp;&amp; matchIntent&#10;  })&#10;&#10;  const filteredExpertQuestions = expertQuestions.filter(q =&gt; {&#10;    const matchQuery = searchQuery.trim() === &quot;&quot; || (q.name + &quot; &quot; + q.filled_prompt).toLowerCase().includes(searchQuery.toLowerCase())&#10;    const matchIntent = intentFilter === &quot;&quot; || q.intent === intentFilter&#10;    return matchQuery &amp;&amp; matchIntent&#10;  })&#10;&#10;  return (&#10;    &lt;div className=&quot;min-h-screen p-8 bg-gradient-to-br from-gray-50 to-gray-100/50&quot;&gt;&#10;      &lt;div className=&quot;mx-auto max-w-7xl space-y-6&quot;&gt;&#10;        &lt;div className=&quot;space-y-3&quot;&gt;&#10;          &lt;div className=&quot;flex items-center justify-between gap-4&quot;&gt;&#10;            &lt;div&gt;&#10;              &lt;h1 className=&quot;text-3xl font-bold&quot;&gt;Question Management&lt;/h1&gt;&#10;              &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Select questions from Database and Expert to create a new question set&lt;/p&gt;&#10;            &lt;/div&gt;&#10;            &lt;div className=&quot;hidden md:flex items-center gap-2&quot;&gt;&#10;              &lt;Input placeholder=&quot;Search questions...&quot; value={searchQuery} onChange={(e) =&gt; setSearchQuery(e.target.value)} className=&quot;w-[320px]&quot; /&gt;&#10;              &lt;select value={intentFilter} onChange={(e) =&gt; setIntentFilter(e.target.value)} className=&quot;text-sm border rounded px-2 py-1&quot;&gt;&#10;                &lt;option value=&quot;&quot;&gt;All intents&lt;/option&gt;&#10;                {allIntents.map(i =&gt; (&lt;option key={i} value={i}&gt;{i}&lt;/option&gt;))}&#10;              &lt;/select&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;          {/* mobile search */}&#10;          &lt;div className=&quot;md:hidden&quot;&gt;&#10;            &lt;Input placeholder=&quot;Search questions...&quot; value={searchQuery} onChange={(e) =&gt; setSearchQuery(e.target.value)} /&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div className=&quot;grid gap-6 lg:grid-cols-2&quot;&gt;&#10;          &lt;Card className=&quot;shadow-lg rounded-xl overflow-hidden&quot;&gt;&#10;            &lt;CardHeader&gt;&#10;              &lt;CardTitle&gt;Database Questions&lt;/CardTitle&gt;&#10;              &lt;CardDescription&gt;Mock list of all questions from the database&lt;/CardDescription&gt;&#10;            &lt;/CardHeader&gt;&#10;            &lt;CardContent className=&quot;p-4&quot;&gt;&#10;              &lt;div className=&quot;space-y-3 max-h-[520px] overflow-y-auto&quot;&gt;&#10;                {filteredDbQuestions.map((q) =&gt; (&#10;                  &lt;div key={q.id} className=&quot;flex items-start gap-3 p-3 rounded-lg bg-white hover:shadow-md transition transform hover:-translate-y-0.5&quot;&gt;&#10;                    &lt;Checkbox id={`db-${q.id}`} checked={dbSelected[q.id]} onCheckedChange={(v) =&gt; toggleDb(q.id, v as boolean)} /&gt;&#10;                    &lt;div className=&quot;flex-1&quot;&gt;&#10;                      &lt;div className=&quot;flex items-center gap-3 mb-1 justify-between&quot;&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;Badge className={`text-xs ${intentColor(q.intent)}`}&gt;{q.intent}&lt;/Badge&gt;&#10;                          &lt;div className=&quot;font-medium&quot;&gt;{q.name}&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div className=&quot;text-sm text-muted-foreground italic&quot;&gt;{q.filled_prompt}&lt;/div&gt;&#10;                      &lt;div className=&quot;text-xs text-muted-foreground mt-2&quot;&gt;ID: {q.id}&lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            &lt;/CardContent&gt;&#10;          &lt;/Card&gt;&#10;&#10;          &lt;Card className=&quot;shadow-lg rounded-xl overflow-hidden&quot;&gt;&#10;            &lt;CardHeader&gt;&#10;              &lt;CardTitle&gt;Expert Questions&lt;/CardTitle&gt;&#10;              &lt;CardDescription&gt;Questions generated by experts&lt;/CardDescription&gt;&#10;            &lt;/CardHeader&gt;&#10;            &lt;CardContent className=&quot;p-4&quot;&gt;&#10;              &lt;div className=&quot;space-y-3 max-h-[520px] overflow-y-auto&quot;&gt;&#10;                {filteredExpertQuestions.map((q) =&gt; (&#10;                  &lt;div key={q.id} className=&quot;flex items-start gap-3 p-3 rounded-lg bg-white hover:shadow-md transition transform hover:-translate-y-0.5&quot;&gt;&#10;                    &lt;Checkbox id={`exp-${q.id}`} checked={expertSelected[q.id]} onCheckedChange={(v) =&gt; toggleExpert(q.id, v as boolean)} /&gt;&#10;&#10;                    &lt;div className=&quot;flex-1&quot;&gt;&#10;                      &lt;div className=&quot;flex items-center gap-2 mb-1 justify-between&quot;&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;Badge className={`text-xs ${intentColor(q.intent)}`}&gt;{q.intent}&lt;/Badge&gt;&#10;                          &lt;div className=&quot;font-medium&quot;&gt;{q.name}&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;DropdownMenu&gt;&#10;                            &lt;DropdownMenuTrigger asChild&gt;&#10;                              &lt;Button variant=&quot;ghost&quot; size=&quot;sm&quot; title=&quot;Actions&quot; className=&quot;w-8 h-8 rounded-full&quot;&gt;&#10;                                &lt;MoreHorizontal className=&quot;w-4 h-4&quot; /&gt;&#10;                              &lt;/Button&gt;&#10;                            &lt;/DropdownMenuTrigger&gt;&#10;                            &lt;DropdownMenuContent align=&quot;end&quot; className=&quot;w-52&quot;&gt;&#10;                              &lt;DropdownMenuLabel&gt;Actions&lt;/DropdownMenuLabel&gt;&#10;                              &lt;DropdownMenuSeparator /&gt;&#10;&#10;                              &lt;div className=&quot;px-2 py-2&quot;&gt;&#10;                                &lt;label className=&quot;text-xs text-muted-foreground&quot;&gt;Rating&lt;/label&gt;&#10;                                &lt;select&#10;                                  value={ratings[q.id] ?? &quot;&quot;}&#10;                                  onChange={(e) =&gt; handleRatingChange(q.id, e.target.value)}&#10;                                  className=&quot;mt-1 w-full text-sm border rounded px-2 py-1&quot;&#10;                                &gt;&#10;                                  &lt;option value=&quot;&quot;&gt;Select&lt;/option&gt;&#10;                                  &lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;&#10;                                  &lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;&#10;                                  &lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;&#10;                                  &lt;option value=&quot;4&quot;&gt;4&lt;/option&gt;&#10;                                  &lt;option value=&quot;5&quot;&gt;5&lt;/option&gt;&#10;                                &lt;/select&gt;&#10;                              &lt;/div&gt;&#10;&#10;                              &lt;DropdownMenuSeparator /&gt;&#10;                              &lt;DropdownMenuItem onClick={() =&gt; startEdit(q)}&gt;&#10;                                &lt;Edit className=&quot;mr-2 h-4 w-4&quot; /&gt;&#10;                                Edit&#10;                              &lt;/DropdownMenuItem&gt;&#10;                              &lt;DropdownMenuItem onClick={() =&gt; deleteExpertQuestion(q.id)} variant=&quot;destructive&quot;&gt;&#10;                                &lt;Trash2 className=&quot;mr-2 h-4 w-4&quot; /&gt;&#10;                                Delete&#10;                              &lt;/DropdownMenuItem&gt;&#10;                            &lt;/DropdownMenuContent&gt;&#10;                          &lt;/DropdownMenu&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;&#10;                      {editingId === q.id ? (&#10;                        &lt;div className=&quot;space-y-2&quot;&gt;&#10;                          &lt;Input value={editingData.name || &quot;&quot;} onChange={(e) =&gt; setEditingData(prev =&gt; ({ ...prev, name: e.target.value }))} /&gt;&#10;                          &lt;Textarea value={editingData.filled_prompt || &quot;&quot;} onChange={(e) =&gt; setEditingData(prev =&gt; ({ ...prev, filled_prompt: e.target.value }))} /&gt;&#10;                          &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                            &lt;Input value={editingData.intent || &quot;&quot;} onChange={(e) =&gt; setEditingData(prev =&gt; ({ ...prev, intent: e.target.value }))} placeholder=&quot;intent&quot; /&gt;&#10;                            &lt;Input value={editingData.question_type || &quot;&quot;} onChange={(e) =&gt; setEditingData(prev =&gt; ({ ...prev, question_type: e.target.value }))} placeholder=&quot;type&quot; /&gt;&#10;                          &lt;/div&gt;&#10;                          &lt;div className=&quot;flex gap-2 pt-2&quot;&gt;&#10;                            &lt;Button size=&quot;sm&quot; onClick={saveEdit} className=&quot;bg-green-600&quot;&gt;Save&lt;/Button&gt;&#10;                            &lt;Button size=&quot;sm&quot; onClick={cancelEdit} variant=&quot;outline&quot;&gt;Cancel&lt;/Button&gt;&#10;                          &lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                      ) : (&#10;                        &lt;&gt;&#10;                          &lt;div className=&quot;text-sm text-muted-foreground italic&quot;&gt;{q.filled_prompt}&lt;/div&gt;&#10;                          &lt;div className=&quot;text-xs text-muted-foreground mt-2&quot;&gt;ID: {q.id}&lt;/div&gt;&#10;                        &lt;/&gt;&#10;                      )}&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            &lt;/CardContent&gt;&#10;          &lt;/Card&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;Card&gt;&#10;          &lt;CardHeader&gt;&#10;            &lt;CardTitle&gt;Create New Question Set&lt;/CardTitle&gt;&#10;            &lt;CardDescription&gt;Enter name, description and create a question set from selected questions&lt;/CardDescription&gt;&#10;          &lt;/CardHeader&gt;&#10;          &lt;CardContent className=&quot;p-4 space-y-4&quot;&gt;&#10;            &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4&quot;&gt;&#10;              &lt;Input placeholder=&quot;Question set name&quot; value={name} onChange={(e) =&gt; setName(e.target.value)} /&gt;&#10;              &lt;Textarea placeholder=&quot;Description (optional)&quot; value={description} onChange={(e) =&gt; setDescription(e.target.value)} /&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div className=&quot;flex items-center justify-between&quot;&gt;&#10;              &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;Selected total: {(Object.values(dbSelected).filter(Boolean).length) + (Object.values(expertSelected).filter(Boolean).length)} questions&lt;/div&gt;&#10;              &lt;Button onClick={createQuestionSet} className=&quot;bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700&quot;&gt;Create Question Set&lt;/Button&gt;&#10;            &lt;/div&gt;&#10;          &lt;/CardContent&gt;&#10;        &lt;/Card&gt;&#10;&#10;        &lt;Card className=&quot;shadow-md rounded-lg&quot;&gt;&#10;          &lt;CardHeader&gt;&#10;            &lt;CardTitle&gt;Selected Questions&lt;/CardTitle&gt;&#10;            &lt;CardDescription&gt;Preview of selected questions for the new set&lt;/CardDescription&gt;&#10;          &lt;/CardHeader&gt;&#10;          &lt;CardContent className=&quot;p-4&quot;&gt;&#10;            {selectedQuestions.length === 0 ? (&#10;              &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;No questions selected yet&lt;/div&gt;&#10;            ) : (&#10;              &lt;div&gt;&#10;                &lt;div className=&quot;flex items-center justify-between mb-4&quot;&gt;&#10;                  &lt;div&gt;&#10;                    &lt;div className=&quot;text-sm font-medium&quot;&gt;Question Set: {name || &quot;&lt;name&gt;&quot;}&lt;/div&gt;&#10;                    &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;{description}&lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;Total: &lt;span className=&quot;font-semibold text-700&quot;&gt;{selectedQuestions.length}&lt;/span&gt;&lt;/div&gt;&#10;                &lt;/div&gt;&#10;&#10;                &lt;div className=&quot;grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4&quot;&gt;&#10;                  {selectedQuestions.map((q) =&gt; (&#10;                    &lt;div key={q.id} className=&quot;bg-white border rounded-lg p-3 shadow-sm hover:shadow-md transition&quot;&gt;&#10;                      &lt;div className=&quot;flex items-start justify-between gap-2&quot;&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;Badge className={`text-xs ${intentColor(q.intent)}`}&gt;{q.intent}&lt;/Badge&gt;&#10;                          &lt;div className=&quot;font-medium&quot;&gt;{q.name}&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;div className=&quot;text-right&quot;&gt;&#10;                          {ratings[q.id] ? (&#10;                            &lt;Badge className=&quot;bg-yellow-100 text-yellow-800&quot;&gt;{ratings[q.id]} ★&lt;/Badge&gt;&#10;                          ) : (&#10;                            &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;No rating&lt;/div&gt;&#10;                          )}&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;&#10;                      &lt;div className=&quot;mt-2 text-sm text-muted-foreground line-clamp-3&quot;&gt;{q.filled_prompt}&lt;/div&gt;&#10;                      &lt;div className=&quot;mt-3 flex items-center justify-between text-xs text-muted-foreground&quot;&gt;&#10;                        &lt;div&gt;ID: &lt;span className=&quot;font-mono text-[11px]&quot;&gt;{q.id.slice(0,8)}…&lt;/span&gt;&lt;/div&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;Type: &lt;span className=&quot;font-medium&quot;&gt;{q.question_type}&lt;/span&gt;&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            )}&#10;          &lt;/CardContent&gt;&#10;        &lt;/Card&gt;&#10;&#10;        {/* New: Saved Question Sets list (bottom box) */}&#10;        &lt;Card className=&quot;mt-4&quot;&gt;&#10;          &lt;CardHeader&gt;&#10;            &lt;CardTitle&gt;Saved Question Sets&lt;/CardTitle&gt;&#10;            &lt;CardDescription&gt;List of created question sets (preview)&lt;/CardDescription&gt;&#10;          &lt;/CardHeader&gt;&#10;          &lt;CardContent className=&quot;p-4&quot;&gt;&#10;            {questionSets.length === 0 ? (&#10;              &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;No saved question sets yet&lt;/div&gt;&#10;            ) : (&#10;              &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4&quot;&gt;&#10;                {questionSets.map((set) =&gt; (&#10;                  &lt;div key={set.id} className=&quot;bg-white border rounded-lg p-4 shadow-sm hover:shadow-md transition&quot;&gt;&#10;                    &lt;div className=&quot;flex items-start justify-between gap-4&quot;&gt;&#10;                      &lt;div&gt;&#10;                        &lt;div className=&quot;text-sm font-semibold&quot;&gt;{set.name}&lt;/div&gt;&#10;                        &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;{set.description || &lt;span className=&quot;italic text-muted-foreground&quot;&gt;No description&lt;/span&gt;}&lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div className=&quot;flex flex-col items-end gap-2&quot;&gt;&#10;                        &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;{set.questionIds.length} questions&lt;/div&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                          &lt;Button size=&quot;sm&quot; variant=&quot;ghost&quot; onClick={() =&gt; navigator.clipboard.writeText(set.id)}&gt;Copy ID&lt;/Button&gt;&#10;                          &lt;Button size=&quot;sm&quot; variant=&quot;destructive&quot; onClick={() =&gt; deleteQuestionSet(set.id)}&gt;Delete&lt;/Button&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div className=&quot;mt-3 flex flex-wrap gap-2&quot;&gt;&#10;                      {set.questionIds.map((qid) =&gt; {&#10;                        const q = getQuestionById(qid)&#10;                        return (&#10;                          &lt;div key={qid} className=&quot;px-3 py-1 rounded-full bg-gray-100 text-sm flex items-center gap-2&quot;&gt;&#10;                            &lt;Badge className=&quot;bg-gray-200 text-xs&quot;&gt;{q?.intent ?? &quot;-&quot;}&lt;/Badge&gt;&#10;                            &lt;div className=&quot;truncate max-w-[160px]&quot;&gt;{q?.name ?? qid}&lt;/div&gt;&#10;                          &lt;/div&gt;&#10;                        )&#10;                      })}&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            )}&#10;          &lt;/CardContent&gt;&#10;        &lt;/Card&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  )&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/dashboard/survey/page.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/dashboard/survey/page.tsx" />
              <option name="originalContent" value="&quot;use client&quot;&#10;&#10;import { SurveyForm } from &quot;@/components/survey/SurveyForm&quot;&#10;import { SurveyScenarioTable } from &quot;@/components/survey/SurveyScenarioTable&quot;&#10;import { SurveySimulator } from &quot;@/components/survey/SurveySimulator&quot;&#10;import { useState } from &quot;react&quot;&#10;import { Card, CardContent, CardHeader, CardTitle, CardDescription } from &quot;@/components/ui/card&quot;&#10;import { Button } from &quot;@/components/ui/button&quot;&#10;import { useToast } from &quot;@/hooks/use-toast&quot;&#10;&#10;interface ScenarioData {&#10;  id: string&#10;  minAge: number&#10;  maxAge: number&#10;  percentage: number&#10;  status: &quot;draft&quot; | &quot;sent&quot;&#10;  location?: string&#10;  gender?: string | null&#10;  questions: Array&lt;{&#10;    id: string&#10;    question: string&#10;  }&gt;&#10;  simulatedSurvey?: any&#10;}&#10;&#10;export default function SurveyPage() {&#10;  const [selectedScenarioId, setSelectedScenarioId] = useState&lt;string | null&gt;(null)&#10;  const [selectedScenario, setSelectedScenario] = useState&lt;ScenarioData | null&gt;(null)&#10;  const [refreshKey, setRefreshKey] = useState(0)&#10;  const [questionsLoaded, setQuestionsLoaded] = useState(false)&#10;  const [loadingQuestions, setLoadingQuestions] = useState(false)&#10;  const { toast } = useToast()&#10;&#10;  const handleViewResult = (scenarioId: string, scenario: ScenarioData) =&gt; {&#10;    setSelectedScenarioId(scenarioId)&#10;    setSelectedScenario(scenario)&#10;  }&#10;&#10;  const handleScenarioDeleted = (deletedScenarioId: string) =&gt; {&#10;    // Nếu scenario đang được xem bị xóa, reset về trạng thái ban đầu&#10;    if (selectedScenarioId === deletedScenarioId) {&#10;      setSelectedScenarioId(null)&#10;      setSelectedScenario(null)&#10;    }&#10;  }&#10;&#10;  const handleScenarioCreated = () =&gt; {&#10;    setRefreshKey(prev =&gt; prev + 1)&#10;  }&#10;&#10;  return (&#10;    &lt;div className=&quot;min-h-screen bg-gray-50/30 p-8&quot;&gt;&#10;      &lt;div className=&quot;mx-auto max-w-7xl space-y-8&quot;&gt;&#10;        &lt;div className=&quot;space-y-2&quot;&gt;&#10;          &lt;h1 className=&quot;text-3xl font-bold tracking-tight&quot;&gt;Survey Manager&lt;/h1&gt;&#10;          &lt;p className=&quot;text-base text-muted-foreground&quot;&gt;&#10;            Create demographic scenarios and simulate survey distribution&#10;          &lt;/p&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;Card&gt;&#10;          &lt;CardHeader&gt;&#10;            &lt;CardTitle&gt;Survey Questions&lt;/CardTitle&gt;&#10;            &lt;CardDescription&gt;Load questions from the server&lt;/CardDescription&gt;&#10;          &lt;/CardHeader&gt;&#10;          &lt;CardContent&gt;&#10;            {!questionsLoaded ? (&#10;              &lt;div className=&quot;flex flex-col items-start gap-3&quot;&gt;&#10;                &lt;div className=&quot;text-sm text-muted-foreground&quot;&gt;No questions loaded yet. Click &quot;Get Questions&quot; to load from server.&lt;/div&gt;&#10;                &lt;div&gt;&#10;                  &lt;Button onClick={async () =&gt; {&#10;                    try {&#10;                      setLoadingQuestions(true)&#10;                      // TODO: replace with real API call&#10;                      // await fetch('/api/questions')&#10;                      setQuestionsLoaded(true)&#10;                      toast({ title: 'Loaded', description: 'Questions loaded from server' })&#10;                    } catch (e) {&#10;                      toast({ title: 'Error', description: 'Failed to load questions', variant: 'destructive' })&#10;                    } finally {&#10;                      setLoadingQuestions(false)&#10;                    }&#10;                  }} disabled={loadingQuestions}&gt;&#10;                    {loadingQuestions ? 'Loading...' : 'Get Questions'}&#10;                  &lt;/Button&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            ) : (&#10;              &lt;div className=&quot;text-sm&quot;&gt;Questions loaded. (Replace with questions list UI)&lt;/div&gt;&#10;            )}&#10;          &lt;/CardContent&gt;&#10;        &lt;/Card&gt;&#10;        &lt;SurveyForm onScenarioCreated={handleScenarioCreated} /&gt;&#10;        &lt;SurveyScenarioTable&#10;          key={refreshKey}&#10;          onViewResult={handleViewResult}&#10;          onScenarioDeleted={handleScenarioDeleted}&#10;        /&gt;&#10;        &lt;SurveySimulator selectedScenarioId={selectedScenarioId} selectedScenario={selectedScenario} /&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  )&#10;}" />
              <option name="updatedContent" value="&quot;use client&quot;&#10;&#10;import { SurveyForm } from &quot;@/components/survey/SurveyForm&quot;&#10;import { SurveyScenarioTable } from &quot;@/components/survey/SurveyScenarioTable&quot;&#10;import { SurveySimulator } from &quot;@/components/survey/SurveySimulator&quot;&#10;import { useState } from &quot;react&quot;&#10;&#10;interface ScenarioData {&#10;  id: string&#10;  minAge: number&#10;  maxAge: number&#10;  percentage: number&#10;  status: &quot;draft&quot; | &quot;sent&quot;&#10;  location?: string&#10;  gender?: string | null&#10;  questions: Array&lt;{&#10;    id: string&#10;    question: string&#10;  }&gt;&#10;  simulatedSurvey?: any&#10;}&#10;&#10;export default function SurveyPage() {&#10;  const [selectedScenarioId, setSelectedScenarioId] = useState&lt;string | null&gt;(null)&#10;  const [selectedScenario, setSelectedScenario] = useState&lt;ScenarioData | null&gt;(null)&#10;  const [refreshKey, setRefreshKey] = useState(0)&#10;&#10;  const handleViewResult = (scenarioId: string, scenario: ScenarioData) =&gt; {&#10;    setSelectedScenarioId(scenarioId)&#10;    setSelectedScenario(scenario)&#10;  }&#10;&#10;  const handleScenarioDeleted = (deletedScenarioId: string) =&gt; {&#10;    // Nếu scenario đang được xem bị xóa, reset về trạng thái ban đầu&#10;    if (selectedScenarioId === deletedScenarioId) {&#10;      setSelectedScenarioId(null)&#10;      setSelectedScenario(null)&#10;    }&#10;  }&#10;&#10;  const handleScenarioCreated = () =&gt; {&#10;    setRefreshKey(prev =&gt; prev + 1)&#10;  }&#10;&#10;  return (&#10;    &lt;div className=&quot;min-h-screen bg-gray-50/30 p-8&quot;&gt;&#10;      &lt;div className=&quot;mx-auto max-w-7xl space-y-8&quot;&gt;&#10;        &lt;div className=&quot;space-y-2&quot;&gt;&#10;          &lt;h1 className=&quot;text-3xl font-bold tracking-tight&quot;&gt;Survey Manager&lt;/h1&gt;&#10;          &lt;p className=&quot;text-base text-muted-foreground&quot;&gt;&#10;            Create demographic scenarios and simulate survey distribution&#10;          &lt;/p&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;SurveyForm onScenarioCreated={handleScenarioCreated} /&gt;&#10;        &lt;SurveyScenarioTable&#10;          key={refreshKey}&#10;          onViewResult={handleViewResult}&#10;          onScenarioDeleted={handleScenarioDeleted}&#10;        /&gt;&#10;        &lt;SurveySimulator selectedScenarioId={selectedScenarioId} selectedScenario={selectedScenario} /&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  )&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/components/survey/QuestionModal.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/components/survey/QuestionModal.tsx" />
              <option name="originalContent" value="&quot;use client&quot;&#10;&#10;import { useState, useEffect } from &quot;react&quot;&#10;import {&#10;  Dialog,&#10;  DialogContent,&#10;  DialogDescription,&#10;  DialogFooter,&#10;  DialogHeader,&#10;  DialogTitle,&#10;} from &quot;@/components/ui/dialog&quot;&#10;import { Button } from &quot;@/components/ui/button&quot;&#10;import { Checkbox } from &quot;@/components/ui/checkbox&quot;&#10;import { Label } from &quot;@/components/ui/label&quot;&#10;import { useToast } from &quot;@/hooks/use-toast&quot;&#10;import { CheckCircle2, Loader2 } from &quot;lucide-react&quot;&#10;import { getAllQuestions } from &quot;@/lib/auth&quot;&#10;import { attachQuestions } from &quot;@/lib/survey&quot;&#10;&#10;interface QuestionModalProps {&#10;  open: boolean&#10;  onOpenChange: (open: boolean) =&gt; void&#10;  scenarioId: string&#10;  selectedQuestions: Array&lt;{ id: string; question: string }&gt;&#10;  onSuccess?: () =&gt; void&#10;}&#10;&#10;export function QuestionModal({ open, onOpenChange, scenarioId, selectedQuestions, onSuccess }: QuestionModalProps) {&#10;  const { toast } = useToast()&#10;  const [selected, setSelected] = useState&lt;string[]&gt;(selectedQuestions.map(q =&gt; q.id))&#10;  const [questions, setQuestions] = useState&lt;any[]&gt;([])&#10;  const [isLoading, setIsLoading] = useState(false)&#10;  const [isSubmitting, setIsSubmitting] = useState(false)&#10;&#10;  useEffect(() =&gt; {&#10;    if (open) {&#10;      loadQuestionsFromAPI()&#10;    }&#10;  }, [open])&#10;&#10;  const loadQuestionsFromAPI = async () =&gt; {&#10;    setIsLoading(true)&#10;    try {&#10;      const response = await getAllQuestions()&#10;&#10;      // Extract questions from response (handle both array and object response)&#10;      const questionsData = response.data || response || []&#10;      setQuestions(questionsData)&#10;    } catch (error) {&#10;      toast({&#10;        title: &quot;Lỗi&quot;,&#10;        description: &quot;Không thể tải danh sách câu hỏi&quot;,&#10;        variant: &quot;destructive&quot;,&#10;      })&#10;    } finally {&#10;      setIsLoading(false)&#10;    }&#10;  }&#10;&#10;  const handleToggle = (questionId: string) =&gt; {&#10;    setSelected((prev) =&gt; (prev.includes(questionId) ? prev.filter((id) =&gt; id !== questionId) : [...prev, questionId]))&#10;  }&#10;&#10;  const handleConfirm = async () =&gt; {&#10;    setIsSubmitting(true)&#10;    try {&#10;      await attachQuestions(scenarioId, selected)&#10;      toast({&#10;        title: &quot;Questions Attached&quot;,&#10;        description: `${selected.length} question(s) have been attached to this scenario.`,&#10;      })&#10;      onOpenChange(false)&#10;      if (onSuccess) onSuccess()&#10;    } catch (error) {&#10;      toast({&#10;        title: &quot;Error&quot;,&#10;        description: &quot;Failed to attach questions&quot;,&#10;        variant: &quot;destructive&quot;,&#10;      })&#10;    } finally {&#10;      setIsSubmitting(false)&#10;    }&#10;  }&#10;&#10;  return (&#10;    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;&#10;      &lt;DialogContent className=&quot;max-w-2xl&quot;&gt;&#10;        &lt;DialogHeader&gt;&#10;          &lt;DialogTitle className=&quot;text-xl&quot;&gt;Select Survey Questions&lt;/DialogTitle&gt;&#10;          &lt;DialogDescription&gt;Choose one or more questions to attach to this demographic scenario.&lt;/DialogDescription&gt;&#10;        &lt;/DialogHeader&gt;&#10;&#10;        &lt;div className=&quot;max-h-[400px] space-y-3 overflow-y-auto py-4&quot;&gt;&#10;          {isLoading ? (&#10;            &lt;div className=&quot;flex items-center justify-center py-8&quot;&gt;&#10;              &lt;Loader2 className=&quot;h-8 w-8 animate-spin text-muted-foreground&quot; /&gt;&#10;              &lt;span className=&quot;ml-2 text-muted-foreground&quot;&gt;Loading questions...&lt;/span&gt;&#10;            &lt;/div&gt;&#10;          ) : questions.length === 0 ? (&#10;            &lt;div className=&quot;rounded-lg border-2 border-dashed border-gray-200 bg-gray-50/50 py-12 text-center&quot;&gt;&#10;              &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;&#10;                No questions available. Please try again.&#10;              &lt;/p&gt;&#10;            &lt;/div&gt;&#10;          ) : (&#10;            questions.map((question, index) =&gt; (&#10;              &lt;div&#10;                key={question.id || index}&#10;                className=&quot;flex items-start gap-3 rounded-lg border p-4 transition-colors hover:bg-gray-50/50&quot;&#10;              &gt;&#10;                &lt;Checkbox&#10;                  id={question.id || `question-${index}`}&#10;                  checked={selected.includes(question.id || `question-${index}`)}&#10;                  onCheckedChange={() =&gt; handleToggle(question.id || `question-${index}`)}&#10;                  className=&quot;mt-1&quot;&#10;                /&gt;&#10;                &lt;Label htmlFor={question.id || `question-${index}`} className=&quot;flex-1 cursor-pointer text-base leading-relaxed&quot;&gt;&#10;                  {question.text || question.question || question.filled_prompt || `Question ${index + 1}`}&#10;                &lt;/Label&gt;&#10;                {selected.includes(question.id || `question-${index}`) &amp;&amp; (&#10;                  &lt;CheckCircle2 className=&quot;h-5 w-5 text-green-600&quot; /&gt;&#10;                )}&#10;              &lt;/div&gt;&#10;            ))&#10;          )}&#10;        &lt;/div&gt;&#10;&#10;        &lt;DialogFooter className=&quot;gap-2&quot;&gt;&#10;          &lt;Button variant=&quot;outline&quot; onClick={() =&gt; onOpenChange(false)} disabled={isSubmitting}&gt;&#10;            Cancel&#10;          &lt;/Button&gt;&#10;          &lt;Button onClick={handleConfirm} disabled={selected.length === 0 || isLoading || isSubmitting}&gt;&#10;            {isSubmitting ? &quot;Attaching...&quot; : `Confirm (${selected.length} selected)`}&#10;          &lt;/Button&gt;&#10;        &lt;/DialogFooter&gt;&#10;      &lt;/DialogContent&gt;&#10;    &lt;/Dialog&gt;&#10;  )&#10;}" />
              <option name="updatedContent" value="&quot;use client&quot;&#10;&#10;import { useState, useEffect } from &quot;react&quot;&#10;import {&#10;  Dialog,&#10;  DialogContent,&#10;  DialogDescription,&#10;  DialogFooter,&#10;  DialogHeader,&#10;  DialogTitle,&#10;} from &quot;@/components/ui/dialog&quot;&#10;import { Button } from &quot;@/components/ui/button&quot;&#10;import { Checkbox } from &quot;@/components/ui/checkbox&quot;&#10;import { Label } from &quot;@/components/ui/label&quot;&#10;import { useToast } from &quot;@/hooks/use-toast&quot;&#10;import { CheckCircle2, Loader2 } from &quot;lucide-react&quot;&#10;import { getAllQuestions } from &quot;@/lib/auth&quot;&#10;import { attachQuestions } from &quot;@/lib/survey&quot;&#10;&#10;interface QuestionModalProps {&#10;  open: boolean&#10;  onOpenChange: (open: boolean) =&gt; void&#10;  scenarioId: string&#10;  selectedQuestions: Array&lt;{ id: string; question: string }&gt;&#10;  onSuccess?: () =&gt; void&#10;}&#10;&#10;export function QuestionModal({ open, onOpenChange, scenarioId, selectedQuestions, onSuccess }: QuestionModalProps) {&#10;  const { toast } = useToast()&#10;  const [selected, setSelected] = useState&lt;string[]&gt;(selectedQuestions.map(q =&gt; q.id))&#10;  const [questions, setQuestions] = useState&lt;any[]&gt;([])&#10;  const [isLoading, setIsLoading] = useState(false)&#10;  const [isSubmitting, setIsSubmitting] = useState(false)&#10;  const [savedSets, setSavedSets] = useState&lt;{ id: string; name: string; description: string; questionIds: string[] }[]&gt;([])&#10;&#10;  useEffect(() =&gt; {&#10;    if (open) {&#10;      loadQuestionsFromAPI()&#10;      // load saved question sets from Question Manager (localStorage)&#10;      try {&#10;        const raw = localStorage.getItem(&quot;questionSets&quot;)&#10;        if (raw) {&#10;          const parsed = JSON.parse(raw)&#10;          if (Array.isArray(parsed)) setSavedSets(parsed)&#10;        }&#10;      } catch (e) {&#10;        console.warn(&quot;Failed to load saved question sets&quot;, e)&#10;      }&#10;    }&#10;  }, [open])&#10;&#10;  const applySavedSet = (setId: string) =&gt; {&#10;    const s = savedSets.find(x =&gt; x.id === setId)&#10;    if (!s) return&#10;    setSelected(s.questionIds.slice())&#10;    toast({ title: &quot;Question Set Applied&quot;, description: `&quot;${s.name}&quot; selected (${s.questionIds.length} questions)` })&#10;  }&#10;  &#10;  const clearSelection = () =&gt; setSelected([])&#10;&#10;  const loadQuestionsFromAPI = async () =&gt; {&#10;    setIsLoading(true)&#10;    try {&#10;      const response = await getAllQuestions()&#10;&#10;      // Extract questions from response (handle both array and object response)&#10;      const questionsData = response.data || response || []&#10;      setQuestions(questionsData)&#10;    } catch (error) {&#10;      toast({&#10;        title: &quot;Lỗi&quot;,&#10;        description: &quot;Không thể tải danh sách câu hỏi&quot;,&#10;        variant: &quot;destructive&quot;,&#10;      })&#10;    } finally {&#10;      setIsLoading(false)&#10;    }&#10;  }&#10;&#10;  const handleToggle = (questionId: string) =&gt; {&#10;    setSelected((prev) =&gt; (prev.includes(questionId) ? prev.filter((id) =&gt; id !== questionId) : [...prev, questionId]))&#10;  }&#10;&#10;  const handleConfirm = async () =&gt; {&#10;    setIsSubmitting(true)&#10;    try {&#10;      await attachQuestions(scenarioId, selected)&#10;      toast({&#10;        title: &quot;Questions Attached&quot;,&#10;        description: `${selected.length} question(s) have been attached to this scenario.`,&#10;      })&#10;      onOpenChange(false)&#10;      if (onSuccess) onSuccess()&#10;    } catch (error) {&#10;      toast({&#10;        title: &quot;Error&quot;,&#10;        description: &quot;Failed to attach questions&quot;,&#10;        variant: &quot;destructive&quot;,&#10;      })&#10;    } finally {&#10;      setIsSubmitting(false)&#10;    }&#10;  }&#10;&#10;  return (&#10;    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;&#10;      &lt;DialogContent className=&quot;max-w-2xl&quot;&gt;&#10;        &lt;DialogHeader&gt;&#10;          &lt;DialogTitle className=&quot;text-xl&quot;&gt;Select Survey Questions&lt;/DialogTitle&gt;&#10;          &lt;DialogDescription&gt;Choose one or more questions to attach to this demographic scenario.&lt;/DialogDescription&gt;&#10;        &lt;/DialogHeader&gt;&#10;&#10;        {/* Saved question sets area */}&#10;        &lt;div className=&quot;mb-3&quot;&gt;&#10;          &lt;div className=&quot;flex items-center justify-between gap-2&quot;&gt;&#10;            &lt;div className=&quot;text-sm font-medium&quot;&gt;Saved Question Sets&lt;/div&gt;&#10;            &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;Pick a set to load its questions&lt;/div&gt;&#10;          &lt;/div&gt;&#10;          {savedSets.length === 0 ? (&#10;            &lt;div className=&quot;text-sm text-muted-foreground mt-2&quot;&gt;No saved question sets available&lt;/div&gt;&#10;          ) : (&#10;            &lt;div className=&quot;mt-2 flex flex-wrap gap-2&quot;&gt;&#10;              {savedSets.map((s) =&gt; (&#10;                &lt;div key={s.id} className=&quot;flex items-center gap-2 bg-gray-50 border rounded-md px-3 py-1&quot;&gt;&#10;                  &lt;div className=&quot;text-sm font-medium&quot;&gt;{s.name}&lt;/div&gt;&#10;                  &lt;div className=&quot;text-xs text-muted-foreground&quot;&gt;{s.questionIds.length} Q&lt;/div&gt;&#10;                  &lt;Button size=&quot;sm&quot; variant=&quot;ghost&quot; onClick={() =&gt; applySavedSet(s.id)}&gt;Use&lt;/Button&gt;&#10;                &lt;/div&gt;&#10;              ))}&#10;              &lt;Button size=&quot;sm&quot; variant=&quot;outline&quot; onClick={clearSelection}&gt;Clear&lt;/Button&gt;&#10;            &lt;/div&gt;&#10;          )}&#10;        &lt;/div&gt;&#10;&#10;        &lt;div className=&quot;max-h-[400px] space-y-3 overflow-y-auto py-4&quot;&gt;&#10;          {isLoading ? (&#10;            &lt;div className=&quot;flex items-center justify-center py-8&quot;&gt;&#10;              &lt;Loader2 className=&quot;h-8 w-8 animate-spin text-muted-foreground&quot; /&gt;&#10;              &lt;span className=&quot;ml-2 text-muted-foreground&quot;&gt;Loading questions...&lt;/span&gt;&#10;            &lt;/div&gt;&#10;          ) : questions.length === 0 ? (&#10;            &lt;div className=&quot;rounded-lg border-2 border-dashed border-gray-200 bg-gray-50/50 py-12 text-center&quot;&gt;&#10;              &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;&#10;                No questions available. Please try again.&#10;              &lt;/p&gt;&#10;            &lt;/div&gt;&#10;          ) : (&#10;            questions.map((question, index) =&gt; (&#10;              &lt;div&#10;                key={question.id || index}&#10;                className=&quot;flex items-start gap-3 rounded-lg border p-4 transition-colors hover:bg-gray-50/50&quot;&#10;              &gt;&#10;                &lt;Checkbox&#10;                  id={question.id || `question-${index}`}&#10;                  checked={selected.includes(question.id || `question-${index}`)}&#10;                  onCheckedChange={() =&gt; handleToggle(question.id || `question-${index}`)}&#10;                  className=&quot;mt-1&quot;&#10;                /&gt;&#10;                &lt;Label htmlFor={question.id || `question-${index}`} className=&quot;flex-1 cursor-pointer text-base leading-relaxed&quot;&gt;&#10;                  {question.text || question.question || question.filled_prompt || `Question ${index + 1}`}&#10;                &lt;/Label&gt;&#10;                {selected.includes(question.id || `question-${index}`) &amp;&amp; (&#10;                  &lt;CheckCircle2 className=&quot;h-5 w-5 text-green-600&quot; /&gt;&#10;                )}&#10;              &lt;/div&gt;&#10;            ))&#10;          )}&#10;        &lt;/div&gt;&#10;&#10;        &lt;DialogFooter className=&quot;gap-2&quot;&gt;&#10;          &lt;Button variant=&quot;outline&quot; onClick={() =&gt; onOpenChange(false)} disabled={isSubmitting}&gt;&#10;            Cancel&#10;          &lt;/Button&gt;&#10;          &lt;Button onClick={handleConfirm} disabled={selected.length === 0 || isLoading || isSubmitting}&gt;&#10;            {isSubmitting ? &quot;Attaching...&quot; : `Confirm (${selected.length} selected)`}&#10;          &lt;/Button&gt;&#10;        &lt;/DialogFooter&gt;&#10;      &lt;/DialogContent&gt;&#10;    &lt;/Dialog&gt;&#10;  )&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>